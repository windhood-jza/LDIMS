# LDIMS 实现规划 (分阶段)

基于完善的准备工作（Demo 页面、需求文档、数据库设计、API 设计），我们可以设计一个分阶段、模块化的实现计划，就像搭积木一样逐步构建 LDIMS 应用。这个过程强调先搭建基础，再逐层实现核心功能，最后完善辅助功能和进行优化。

**阶段一：项目基础架构搭建 (地基)**

1.  **环境准备与项目初始化**:
    *   **后端 (Node.js + Express + TypeScript)**:
        *   [✅] 创建项目目录，初始化 `npm` (`npm init -y`) (已完成)。
        *   [✅] 安装核心依赖：`express`, `mysql2`, `sequelize`, `@types/express`, `typescript`, `ts-node`, `nodemon` 等 (已完成)。
        *   [✅] 配置 `tsconfig.json` 进行 TypeScript 编译 (已完成)。
        *   [✅] 搭建基础目录结构：`src/` (包含 `routes`, `controllers`, `models`, `services`, `config`, `utils` 等) (已完成)。
    *   **前端 (Vue3 + Vite + TypeScript + Element Plus)**:
        *   [✅] 使用 Vite 创建 Vue3 + TypeScript 项目 (`npm create vite@latest frontend --template vue-ts`) (已完成)。
        *   [✅] 安装 `element-plus` 和 `vue-router` (已完成)。
        *   [✅] 配置 Element Plus 按需引入或全局引入 (已完成)。
        *   [✅] 搭建基础目录结构：`src/` (包含 `components`, `views`, `router`, `services/api`, `styles`, `layouts` 等) (已完成)。
    *   **数据库 (MySQL)**:
        *   [✅] 创建 `LDIMS_DB` 数据库 (已完成)。
    *   **版本控制**:
        *   [✅] 初始化 Git 仓库，进行首次提交 (已完成)。

2.  **数据库连接与模型**:
    *   **后端**:
        *   [✅] 在 `config` 中配置数据库连接信息（使用环境变量 `.env` 文件管理敏感信息如密码）(已完成)。
        *   [✅] 实现 Sequelize 初始化和连接逻辑，**特别注意**：根据需求，即使连接失败，服务也应能启动，并在后续提供配置接口/提示。可以设计一个连接状态管理模块 (已完成)。
        *   [✅] 根据 `需求文档_LDIMS.md` 定义 Sequelize 模型 (`User`, `Department`, `DocType`, `Document`, `OperationLog`, `SearchCondition`, `ExportTask`)，建立模型间的关联关系 (Associations) (已完成)。

3.  **数据库初始化**:
    *   **后端/脚本**:
        *   [✅] 编写一个脚本或使用 Sequelize Migrations/Seeders 功能，根据 `需求文档_LDIMS.md` 中的 `CREATE TABLE` 语句创建所有数据库表 (已完成)。
        *   [✅] 执行初始化 SQL，创建默认的"总部"部门和"admin"用户 (已完成)。

4.  **基础服务与布局**:
    *   **后端**:
        *   [✅] 创建基础的 Express 应用实例，设置中间件 (如 `cors`, `body-parser`) (已完成，并在 `app.ts` 中设置路由入口)。
        *   [✅] 定义统一的 API 响应格式 (`ApiResponse`) 和错误处理中间件 (已完成)。
        *   [✅] 实现一个简单的健康检查接口 (`/api/v1/health`) (已完成)。
    *   **前端**:
        *   [✅] 创建基础布局组件 (`src/layouts/DefaultLayout.vue`)，包含侧边栏 (Sidebar)、顶部导航栏 (Header) 和主内容区域 (Main Content)，样式参考 Demo 文件 (已完成)。
        *   [✅] 配置 Vue Router (`src/router/index.ts`)，设置基础路由结构，应用 `DefaultLayout` (已完成)。

**阶段二：核心认证与基础管理模块 (骨架)**

5.  **认证模块 (Auth)**:
    *   **后端**: 
        *   [✅] 实现用户登录接口 (`/auth/login`)，验证用户名密码，生成 JWT (JSON Web Token) (已完成)。
        *   [✅] 实现修改密码接口 (已完成)。
        *   [✅] 实现 JWT 验证中间件，用于保护后续需要登录的接口 (已完成)。
    *   **前端**: 
        *   [✅] 创建登录页面 (`src/views/Login.vue`)，样式参考 `login.html` (已完成)。
        *   [ ] 实现登录表单、API 调用和登录成功后的 Token 存储 (如 `localStorage`) 及页面跳转 (API 调用待替换真实接口，其他已完成)。
        *   [✅] 设置路由守卫，未登录用户访问受保护页面时跳转到登录页 (已完成)。

6.  **用户管理模块 (User)**:
    *   **后端**: 实现用户管理的 CRUD (创建、读取、更新、删除) API 接口，包括列表查询（带分页、搜索、筛选）。
    *   **前端**: 创建用户管理页面，包含用户列表 (Element Plus Table)、搜索栏、新增/编辑用户的弹窗 (Element Plus Dialog/Form)，样式参考 `user.html`。实现与后端 API 的对接。

7.  **部门管理模块 (Department)**:
    *   **后端**: 实现部门管理的 CRUD API，特别注意获取部门树接口 (`/departments/tree`) 需要包含 `parentName`。
    *   **前端**: 创建部门管理页面 (`src/views/DepartmentManagement.vue`)，使用 Element Plus Tree 组件展示部门结构，提供新增/编辑部门的表单/弹窗，样式参考 `department.html`。实现与后端 API 的对接。

8.  **文档类型管理模块 (DocType)**:
    *   **后端**: 实现文档类型管理的 CRUD API，同样注意获取类型树接口。
    *   **前端**: 创建文档类型管理页面 (`src/views/DocTypeManagement.vue`)，类似部门管理，使用 Tree 组件和表单/弹窗，样式参考 `doctype.html`。实现与后端 API 对接。

**阶段三：核心业务 - 文档管理实现 (血肉)**

9.  **文档信息管理 (Document)**:
    *   **后端**: 实现文档信息的 CRUD API，注意处理允许为空的字段。实现复杂的列表查询接口，支持多条件搜索、分页、排序。
    *   **前端**: 创建文档管理页面 (`src/views/DocumentManagement.vue`)，包含搜索区域、文档列表 (Table)、分页组件、新增/编辑文档的弹窗/表单（包含日期选择器、下拉框等），样式参考 `document.html`。实现与后端 API 的完整对接。

10. **文档查询与导出**:
    *   **后端**: 完善文档列表查询的后端逻辑 (可能涉及 Fulltext 索引)。实现文档导出接口 (`/documents/export`)，将其设计为异步任务（使用 `ExportTask` 表记录状态），需要支持选择字段和文件类型 (Excel/CSV)。实现任务状态查询接口。
    *   **前端**: 实现前端触发导出操作的逻辑，可能需要一个导出选项的弹窗。在界面某处（如系统设置或单独的任务列表页）显示导出任务的状态。

11. **文档批量导入**:
    *   **后端**: 实现文件上传接口 (`/upload`)。实现批量导入接口 (`/documents/import`)，同样设计为异步任务，处理 Excel 文件解析（推荐使用 `xlsx` 库），根据空值处理规则验证数据并入库，记录成功/失败信息及错误详情到任务状态。实现导入进度查询接口。
    *   **前端**: 实现文件上传组件。实现触发导入操作的逻辑，并能展示导入任务的进度和结果（成功/失败数量，错误详情）。

**阶段四：辅助功能与完善 (锦上添花)**

12. **统计报表模块 (Statistics)**:
    *   **后端**: 实现按部门、按类型、按时间趋势统计的 API 接口，需要编写相应的数据库聚合查询。实现报表导出接口（Excel/图片），可能也需要异步处理。
    *   **前端**: 创建统计报表页面 (`src/views/Statistics.vue`)，使用图表库 (如 ECharts, Chart.js) 展示统计结果，提供筛选条件。实现导出功能。

13. **系统设置与日志 (System)**:
    *   **后端**: 实现获取/更新系统配置接口。实现操作日志记录逻辑（可在重要操作的 Service 层或通过中间件实现）和查询接口。实现数据库配置相关的接口（如果连接失败时需要）。
    *   **前端**: 创建系统设置页面 (`src/views/Settings.vue`)，展示和修改系统配置，提供查看操作日志的界面，样式参考 `setting.html`。如果需要，添加数据库配置表单。

14. **仪表盘 (Dashboard)**:
    *   **后端**: 可能需要聚合一些统计接口的数据或提供专门的仪表盘数据接口。
    *   **前端**: 创建仪表盘页面 (`src/views/Dashboard.vue`)，展示关键统计数据、快捷操作入口、最近文档列表等，样式参考 `dashboard.html`，并调用相关 API 获取数据。

**阶段五：测试、优化与部署准备 (打磨与包装)**

15. **测试**:
    *   **单元测试 (后端)**: 对 Service 层的重要逻辑进行单元测试。
    *   **集成测试 (后端)**: 对 API 接口进行测试，确保其按预期工作。
    *   **端到端测试 (前端)**: 模拟用户操作流程进行测试。
    *   **手动测试**: 全面测试各项功能和边界条件。

16. **优化与完善**:
    *   **代码审查与重构**: 检查代码规范、可读性和性能。
    *   **前端性能优化**: 如代码分割、懒加载、资源压缩等。
    *   **后端性能优化**: 如数据库查询优化、索引检查等。
    *   **UI/UX 完善**: 根据测试反馈调整界面细节。
    *   **文档补充**: 完善 README、API 文档、部署文档。

17. **部署准备**:
    *   配置生产环境的 `.env` 文件。
    *   编写前端和后端的生产环境构建脚本。
    *   准备服务器环境 (Node.js 运行时, MySQL 服务, Nginx 等反向代理)。
    *   编写部署脚本或流程文档。

**贯穿始终的注意事项:**

*   **版本控制 (Git)**: 每个小步骤完成后都进行提交，保持清晰的提交历史。
*   **代码规范**: 遵循一致的编码风格 (可以使用 ESLint, Prettier)。
*   **注释**: 为关键代码添加 JSDoc 或行内注释。
*   **错误处理**: 前后端都需要健壮的错误捕获和处理机制。
*   **安全性**: 注意防止 SQL 注入、XSS 攻击，密码存储（虽然当前需求是明文，但生产环境强烈建议加密），接口权限校验。
*   **组件化与模块化**: 前后端都应遵循良好的模块化设计原则，便于维护和扩展。

// 我将为你创建 src/views/UserManagement.vue 文件，并实现用户列表的获取和展示、分页以及搜索框的基本结构。
// 后续步骤将逐步添加新增、编辑、删除等功能。 