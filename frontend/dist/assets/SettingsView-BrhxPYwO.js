import{w as b,d as J,r as E,l as M,o as K,L as Q,E as C,p as f,g as o,u as e,av as $,i as n,f as a,aw as Z,ax as I,j as d,U as y,ay as ee,a0 as ae,az as te,e as v,s as L,ak as le,v as F,a4 as se,a5 as T,y as h,z as R,k as g,b as oe,ap as re,F as x,O as G,aA as ne,ac as ie,ad as Ee,c as de,D as ue,G as p,t as k,aj as Te,aB as pe,aC as ce,aq as _e,_ as fe}from"./index-CltJVasi.js";const ge=()=>b.get("/system/config"),Ae=A=>b.put("/system/config",A),De=A=>b.get("/system/logs",{params:A}),Se={USER_CREATE:"创建用户",USER_UPDATE:"更新用户",USER_DELETE:"删除用户",USER_ENABLE:"启用用户",USER_DISABLE:"禁用用户",PASSWORD_RESET:"重置密码",DEPARTMENT_CREATE:"创建部门",DEPARTMENT_UPDATE:"更新部门",DEPARTMENT_DELETE:"删除部门",DOCTYPE_CREATE:"创建文档类型",DOCTYPE_UPDATE:"更新文档类型",DOCTYPE_DELETE:"删除文档类型",DOCUMENT_CREATE:"创建文档",DOCUMENT_UPDATE:"更新文档",DOCUMENT_DELETE:"删除文档",ATTACHMENT_UPLOAD:"上传附件",ATTACHMENT_CLEAR:"清空附件",DOCUMENT_EXPORT:"导出文档",DOCUMENT_IMPORT:"导入文档",SYSTEM_CONFIG_UPDATE:"更新系统配置",USER_LOGIN:"用户登录",USER_LOGOUT:"用户登出"},me=[{label:"用户管理",types:["USER_CREATE","USER_UPDATE","USER_DELETE","USER_ENABLE","USER_DISABLE","PASSWORD_RESET"]},{label:"部门管理",types:["DEPARTMENT_CREATE","DEPARTMENT_UPDATE","DEPARTMENT_DELETE"]},{label:"文档类型管理",types:["DOCTYPE_CREATE","DOCTYPE_UPDATE","DOCTYPE_DELETE"]},{label:"文档管理",types:["DOCUMENT_CREATE","DOCUMENT_UPDATE","DOCUMENT_DELETE","ATTACHMENT_UPLOAD","ATTACHMENT_CLEAR","DOCUMENT_EXPORT","DOCUMENT_IMPORT"]},{label:"系统操作",types:["SYSTEM_CONFIG_UPDATE","USER_LOGIN","USER_LOGOUT"]}],Ce={key:0,class:"settings-section"},ye={key:1,class:"settings-section"},ve=J({__name:"SettingsView",setup(A){const D=E("basicSettings"),c=E(!1),V=E(),_=M({FILE_STORAGE_PATH:""}),N=Se,w=me,s=M({page:1,pageSize:10,userId:"",operationType:"",startDate:"",endDate:"",sortField:"createdAt",sortOrder:"DESC"}),S=E(null),O=E([]),m=E(0),P=E(!1);K(()=>{Y(),u()}),Q(S,l=>{s.startDate=(l==null?void 0:l[0])||"",s.endDate=(l==null?void 0:l[1])||""});const H=l=>{D.value=l},Y=async()=>{c.value=!0;try{const l=await ge();l&&l.FILE_STORAGE_PATH!==void 0&&(_.FILE_STORAGE_PATH=l.FILE_STORAGE_PATH),console.log("Fetched system configs:",l)}catch(l){C.error("获取系统配置失败"),console.error("Fetch configs error:",l)}finally{c.value=!1}},z=async()=>{c.value=!0;try{const l={FILE_STORAGE_PATH:_.FILE_STORAGE_PATH};await Ae(l),C.success("系统设置保存成功")}catch(l){C.error("保存系统设置失败"),console.error("Save configs error:",l)}finally{c.value=!1}},u=async()=>{console.log("Fetching logs with query:",JSON.stringify(s)),P.value=!0;try{const l={};for(const U in s){const r=U,i=s[r];i!==""&&i!==null&&i!==void 0&&(l[r]=i)}const t=await De(l);O.value=t.list,m.value=t.total}catch(l){C.error(`获取操作日志失败: ${l.message}`),O.value=[],m.value=0}finally{P.value=!1}},B=l=>{s.pageSize=l,s.page=1,u()},j=l=>{s.page=l,u()},q=({prop:l,order:t})=>{l?(s.sortField=l,s.sortOrder=t==="ascending"?"ASC":"DESC"):(s.sortField="createdAt",s.sortOrder="DESC"),s.page=1,u()},W=()=>{s.page=1,u()},X=()=>{s.page=1,s.userId="",s.operationType="",s.startDate="",s.endDate="",S.value=null,s.sortField="createdAt",s.sortOrder="DESC",u()};return(l,t)=>{const U=de("loading");return n(),f(e($),{class:"settings-container"},{default:o(()=>[a(e(te),{width:"200px",class:"settings-aside"},{default:o(()=>[a(e(Z),{"default-active":D.value,class:"settings-menu",onSelect:H,"background-color":"#f4f4f5","text-color":"#303133","active-text-color":"#409EFF"},{default:o(()=>[a(e(I),{index:"basicSettings"},{default:o(()=>[a(e(y),null,{default:o(()=>[a(e(ee))]),_:1}),t[5]||(t[5]=d("span",null,"基本设置",-1))]),_:1}),a(e(I),{index:"operationLog"},{default:o(()=>[a(e(y),null,{default:o(()=>[a(e(ae))]),_:1}),t[6]||(t[6]=d("span",null,"操作日志",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),a(e(pe),{class:"settings-main"},{default:o(()=>[D.value==="basicSettings"?(n(),v("div",Ce,[t[10]||(t[10]=d("h2",null,"基本设置",-1)),a(e(le),{class:"box-card",shadow:"never"},{header:o(()=>t[7]||(t[7]=[d("div",{class:"card-header"},[d("span",null,"存储设置")],-1)])),default:o(()=>[a(e(F),{model:_,"label-width":"120px",ref_key:"configFormRef",ref:V,onSubmit:t[1]||(t[1]=se(()=>{},["prevent"]))},{default:o(()=>[a(e(T),{label:"文件存储路径",prop:"FILE_STORAGE_PATH"},{default:o(()=>[a(e(h),{modelValue:_.FILE_STORAGE_PATH,"onUpdate:modelValue":t[0]||(t[0]=r=>_.FILE_STORAGE_PATH=r),placeholder:"请输入服务器上的绝对路径"},null,8,["modelValue"]),t[8]||(t[8]=d("div",{class:"el-form-item__tip"}," 服务器上的绝对路径，请确保存储路径存在且服务有读写权限。修改后可能需要重启后端服务。 ",-1))]),_:1}),a(e(T),null,{default:o(()=>[a(e(R),{type:"primary",onClick:z,loading:c.value},{default:o(()=>t[9]||(t[9]=[g("保存设置")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])):L("",!0),D.value==="operationLog"?(n(),v("div",ye,[t[13]||(t[13]=d("h2",null,"操作日志",-1)),a(e(F),{inline:!0,model:s,class:"log-search-form"},{default:o(()=>[a(e(T),{label:"操作用户"},{default:o(()=>[a(e(h),{modelValue:s.userId,"onUpdate:modelValue":t[2]||(t[2]=r=>s.userId=r),placeholder:"用户ID或用户名",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),a(e(T),{label:"操作类型"},{default:o(()=>[a(e(re),{modelValue:s.operationType,"onUpdate:modelValue":t[3]||(t[3]=r=>s.operationType=r),placeholder:"请选择操作类型",clearable:"",class:"operation-type-select"},{default:o(()=>[(n(!0),v(x,null,G(e(w),r=>(n(),f(e(ce),{key:r.label,label:r.label},{default:o(()=>[(n(!0),v(x,null,G(r.types,i=>(n(),f(e(_e),{key:i,label:e(N)[i],value:i},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(e(T),{label:"操作时间"},{default:o(()=>[a(e(ne),{"model-value":S.value??void 0,"onUpdate:modelValue":t[4]||(t[4]=r=>S.value=r??void 0),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:"",style:{width:"240px"}},null,8,["model-value"])]),_:1}),a(e(T),null,{default:o(()=>[a(e(R),{type:"primary",onClick:W},{default:o(()=>[a(e(y),null,{default:o(()=>[a(e(ie))]),_:1}),t[11]||(t[11]=g(" 查询 "))]),_:1}),a(e(R),{onClick:X},{default:o(()=>[a(e(y),null,{default:o(()=>[a(e(Ee))]),_:1}),t[12]||(t[12]=g(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"]),oe((n(),f(e(ue),{data:O.value,style:{width:"100%"},border:"",onSortChange:q},{default:o(()=>[a(e(p),{prop:"id",label:"ID",width:"80",sortable:"custom"}),a(e(p),{prop:"createdAt",label:"操作时间",width:"180",sortable:"custom"}),a(e(p),{label:"操作用户",width:"150",sortable:"custom"},{default:o(({row:r})=>[g(k(r.realName||r.username||"-"),1)]),_:1}),a(e(p),{label:"操作类型",width:"150",sortable:"custom"},{default:o(({row:r})=>[g(k(e(N)[r.operationType]||r.operationType),1)]),_:1}),a(e(p),{prop:"operationContent",label:"操作内容","min-width":"250"}),a(e(p),{prop:"ipAddress",label:"IP 地址",width:"150"})]),_:1},8,["data"])),[[U,P.value]]),m.value>0?(n(),f(e(Te),{key:0,background:"",layout:"total, sizes, prev, pager, next, jumper",total:m.value,"page-sizes":[10,20,50,100],"page-size":s.pageSize,"current-page":s.page,onSizeChange:B,onCurrentChange:j,style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},null,8,["total","page-size","current-page"])):L("",!0)])):L("",!0)]),_:1})]),_:1})}}}),Pe=fe(ve,[["__scopeId","data-v-a8faf60b"]]);export{Pe as default};
