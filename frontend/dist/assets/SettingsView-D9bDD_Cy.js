import{w as V,d as F,r as i,l as Y,o as G,ac as z,E as B,p,g as s,u as e,ad as w,i as E,f as t,ae as j,af as W,j as C,I as m,ag as q,ah as X,b as J,v as K,s as Q,x as _,M as $,a4 as H,e as v,G as A,F as b,ai as Z,C as P,k as D,O as ee,P as ae,c as te,V as le,a6 as u,t as N,W as se,aj as oe,ak as re,a5 as ne,_ as Ee}from"./index-DAb5ELNo.js";const de=O=>V.get("/system/logs",{params:O}),ue={USER_CREATE:"创建用户",USER_UPDATE:"更新用户",USER_DELETE:"删除用户",USER_ENABLE:"启用用户",USER_DISABLE:"禁用用户",PASSWORD_RESET:"重置密码",DEPARTMENT_CREATE:"创建部门",DEPARTMENT_UPDATE:"更新部门",DEPARTMENT_DELETE:"删除部门",DOCTYPE_CREATE:"创建文档类型",DOCTYPE_UPDATE:"更新文档类型",DOCTYPE_DELETE:"删除文档类型",DOCUMENT_CREATE:"创建文档",DOCUMENT_UPDATE:"更新文档",DOCUMENT_DELETE:"删除文档",DOCUMENT_EXPORT:"导出文档",DOCUMENT_IMPORT:"导入文档",SYSTEM_CONFIG_UPDATE:"更新系统配置",USER_LOGIN:"用户登录",USER_LOGOUT:"用户登出"},ie=[{label:"用户管理",types:["USER_CREATE","USER_UPDATE","USER_DELETE","USER_ENABLE","USER_DISABLE","PASSWORD_RESET"]},{label:"部门管理",types:["DEPARTMENT_CREATE","DEPARTMENT_UPDATE","DEPARTMENT_DELETE"]},{label:"文档类型管理",types:["DOCTYPE_CREATE","DOCTYPE_UPDATE","DOCTYPE_DELETE"]},{label:"文档管理",types:["DOCUMENT_CREATE","DOCUMENT_UPDATE","DOCUMENT_DELETE","DOCUMENT_EXPORT","DOCUMENT_IMPORT"]},{label:"系统操作",types:["SYSTEM_CONFIG_UPDATE","USER_LOGIN","USER_LOGOUT"]}],pe={class:"settings-section"},ce=F({__name:"SettingsView",setup(O){const y=i("operationLog"),U=ue,M=ie,a=Y({page:1,pageSize:10,userId:"",operationType:"",startDate:"",endDate:"",sortField:"createdAt",sortOrder:"DESC"}),c=i(null),g=i([]),T=i(0),f=i(!1);G(()=>{d()}),z(c,l=>{a.startDate=(l==null?void 0:l[0])||"",a.endDate=(l==null?void 0:l[1])||""});const R=l=>{y.value=l},d=async()=>{console.log("Fetching logs with query:",JSON.stringify(a)),f.value=!0;try{const l={};for(const S in a){const r=S,n=a[r];n!==""&&n!==null&&n!==void 0&&(l[r]=n)}const o=await de(l);g.value=o.list,T.value=o.total}catch(l){B.error(`获取操作日志失败: ${l.message}`),g.value=[],T.value=0}finally{f.value=!1}},h=l=>{a.pageSize=l,a.page=1,d()},L=l=>{a.page=l,d()},I=({prop:l,order:o})=>{l?(a.sortField=l,a.sortOrder=o==="ascending"?"ASC":"DESC"):(a.sortField="createdAt",a.sortOrder="DESC"),a.page=1,d()},x=()=>{a.page=1,d()},k=()=>{a.page=1,a.userId="",a.operationType="",a.startDate="",a.endDate="",c.value=null,a.sortField="createdAt",a.sortOrder="DESC",d()};return(l,o)=>{const S=te("loading");return E(),p(e(w),{class:"settings-container"},{default:s(()=>[t(e(X),{width:"200px",class:"settings-aside"},{default:s(()=>[t(e(j),{"default-active":y.value,class:"settings-menu",onSelect:R,"background-color":"#f4f4f5","text-color":"#303133","active-text-color":"#409EFF"},{default:s(()=>[t(e(W),{index:"operationLog"},{default:s(()=>[t(e(m),null,{default:s(()=>[t(e(q))]),_:1}),o[3]||(o[3]=C("span",null,"操作日志",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),t(e(oe),{class:"settings-main"},{default:s(()=>[C("div",pe,[o[6]||(o[6]=C("h2",null,"操作日志",-1)),t(e(Q),{inline:!0,model:a,class:"log-search-form"},{default:s(()=>[t(e(_),{label:"操作用户"},{default:s(()=>[t(e($),{modelValue:a.userId,"onUpdate:modelValue":o[0]||(o[0]=r=>a.userId=r),placeholder:"用户ID或用户名",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),t(e(_),{label:"操作类型"},{default:s(()=>[t(e(H),{modelValue:a.operationType,"onUpdate:modelValue":o[1]||(o[1]=r=>a.operationType=r),placeholder:"请选择操作类型",clearable:"",class:"operation-type-select"},{default:s(()=>[(E(!0),v(b,null,A(e(M),r=>(E(),p(e(re),{key:r.label,label:r.label},{default:s(()=>[(E(!0),v(b,null,A(r.types,n=>(E(),p(e(ne),{key:n,label:e(U)[n],value:n},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e(_),{label:"操作时间"},{default:s(()=>[t(e(Z),{"model-value":c.value??void 0,"onUpdate:modelValue":o[2]||(o[2]=r=>c.value=r??void 0),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:"",style:{width:"240px"}},null,8,["model-value"])]),_:1}),t(e(_),null,{default:s(()=>[t(e(P),{type:"primary",onClick:x},{default:s(()=>[t(e(m),null,{default:s(()=>[t(e(ee))]),_:1}),o[4]||(o[4]=D(" 查询 "))]),_:1}),t(e(P),{onClick:k},{default:s(()=>[t(e(m),null,{default:s(()=>[t(e(ae))]),_:1}),o[5]||(o[5]=D(" 重置 "))]),_:1})]),_:1})]),_:1},8,["model"]),J((E(),p(e(le),{data:g.value,style:{width:"100%"},border:"",onSortChange:I},{default:s(()=>[t(e(u),{prop:"id",label:"ID",width:"80",sortable:"custom"}),t(e(u),{prop:"createdAt",label:"操作时间",width:"180",sortable:"custom"}),t(e(u),{label:"操作用户",width:"150",sortable:"custom"},{default:s(({row:r})=>[D(N(r.realName||r.username||"-"),1)]),_:1}),t(e(u),{label:"操作类型",width:"150",sortable:"custom"},{default:s(({row:r})=>[D(N(e(U)[r.operationType]||r.operationType),1)]),_:1}),t(e(u),{prop:"operationContent",label:"操作内容","min-width":"250"}),t(e(u),{prop:"ipAddress",label:"IP 地址",width:"150"})]),_:1},8,["data"])),[[S,f.value]]),T.value>0?(E(),p(e(se),{key:0,background:"",layout:"total, sizes, prev, pager, next, jumper",total:T.value,"page-sizes":[10,20,50,100],"page-size":a.pageSize,"current-page":a.page,onSizeChange:h,onCurrentChange:L,style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},null,8,["total","page-size","current-page"])):K("",!0)])]),_:1})]),_:1})}}}),_e=Ee(ce,[["__scopeId","data-v-ebe53438"]]);export{_e as default};
