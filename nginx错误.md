/usr/share/nginx/html/assets/index-CBvB2BG7.js:`+r):o.stack=r}catch{}}throw o}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=il(this.defaults,n);const{transitional:o,paramsSerializer:a,headers:r}=n;o!==void 0&&pc.assertOptions(o,{silentJSONParsing:Qo.transitional(Qo.boolean),forcedJSONParsing:Qo.transitional(Qo.boolean),clarifyTimeoutError:Qo.transitional(Qo.boolean)},!1),a!=null&&(Re.isFunction(a)?n.paramsSerializer={serialize:a}:pc.assertOptions(a,{encode:Qo.function,serialize:Qo.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),pc.assertOptions(n,{baseUrl:Qo.spelling("baseURL"),withXsrfToken:Qo.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let l=r&&Re.merge(r.common,r[n.method]);r&&Re.forEach(["delete","get","head","post","put","patch","common"],m=>{delete r[m]}),n.headers=ro.concat(l,r);const i=[];let u=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(n)===!1||(u=u&&v.synchronous,i.unshift(v.fulfilled,v.rejected))});const c=[];this.interceptors.response.forEach(function(v){c.push(v.fulfilled,v.rejected)});let d,f=0,p;if(!u){const m=[Gb.bind(this),void 0];for(m.unshift.apply(m,i),m.push.apply(m,c),p=m.length,d=Promise.resolve(n);f<p;)d=d.then(m[f++],m[f++]);return d}p=i.length;let h=n;for(f=0;f<p;){const m=i[f++],v=i[f++];try{h=m(h)}catch(y){v.call(this,y);break}}try{d=Gb.call(this,h)}catch(m){return Promise.reject(m)}for(f=0,p=c.length;f<p;)d=d.then(c[f++],c[f++]);return d}getUri(t){t=il(this.defaults,t);const n=CE(t.baseURL,t.url,t.allowAbsoluteUrls);return mE(n,t.params,t.paramsSerializer)}};Re.forEach(["delete","get","head","options"],function(t){Zr.prototype[t]=function(n,o){return this.request(il(o||{},{method:t,url:n,data:(o||{}).data}))}});Re.forEach(["post","put","patch"],function(t){function n(o){return function(r,l,i){return this.request(il(i||{},{method:t,headers:o?{"Content-Type":"multipart/form-data"}:{},url:r,data:l}))}}Zr.prototype[t]=n(),Zr.prototype[t+"Form"]=n(!0)});let gee=class $E{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(r){n=r});const o=this;this.promise.then(a=>{if(!o._listeners)return;let r=o._listeners.length;for(;r-- >0;)o._listeners[r](a);o._listeners=null}),this.promise.then=a=>{let r;const l=new Promise(i=>{o.subscribe(i),r=i}).then(a);return l.cancel=function(){o.unsubscribe(r)},l},t(function(r,l,i){o.reason||(o.reason=new Ms(r,l,i),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=o=>{t.abort(o)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new $E(function(a){t=a}),cancel:t}}};function yee(e){return function(n){return e.apply(null,n)}}function bee(e){return Re.isObject(e)&&e.isAxiosError===!0}const Ph={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ph).forEach(([e,t])=>{Ph[t]=e});function OE(e){const t=new Zr(e),n=rE(Zr.prototype.request,t);return Re.extend(n,Zr.prototype,t,{allOwnKeys:!0}),Re.extend(n,t,null,{allOwnKeys:!0}),n.create=function(a){return OE(il(e,a))},n}const un=OE(vu);un.Axios=Zr;un.CanceledError=Ms;un.CancelToken=gee;un.isCancel=bE;un.VERSION=TE;un.toFormData=Ud;un.AxiosError=Et;un.Cancel=un.CanceledError;un.all=function(t){return Promise.all(t)};un.spread=yee;un.isAxiosError=bee;un.mergeConfig=il;un.AxiosHeaders=ro;un.formToJSON=e=>yE(Re.isHTMLForm(e)?new FormData(e):e);un.getAdapter=EE.getAdapter;un.HttpStatusCode=Ph;un.default=un;const{Axios:yne,AxiosError:bne,CanceledError:wne,isCancel:Cne,CancelToken:Sne,VERSION:_ne,all:kne,Cancel:Ene,isAxiosError:Tne,spread:$ne,toFormData:One,AxiosHeaders:Mne,HttpStatusCode:Nne,formToJSON:xne,getAdapter:Rne,mergeConfig:Pne}=un,ME="http://10.1.2.239:3000/api/v1",NE=parseInt("10000",10);console.log(`[request.ts] API baseURL: ${ME}, Timeout: ${NE}`);const Vr=un.create({baseURL:ME,timeout:NE});Vr.interceptors.request.use(e=>{console.log("[request.ts:interceptor] Request interceptor START."),console.log("[request.ts:interceptor] Original config.params:",JSON.stringify(e.params,null,2));const t=localStorage.getItem("authToken");return t?(e.headers.Authorization=`Bearer ${t}`,console.log("[request.ts:interceptor] Token added to headers.")):console.log("[request.ts:interceptor] No token found."),console.log("[request.ts:interceptor] config.params BEFORE returning config:",JSON.stringify(e.params,null,2)),console.log("[request.ts:interceptor] Request interceptor END."),e},e=>(console.error("Request error:",e),Promise.reject(e)));Vr.interceptors.response.use(e=>{const t=e.data;return t&&t.code!==void 0?t.code===200||t.code===201?t.data!==void 0?t.data:t:(dn({message:t.message||"业务处理失败",type:"error",duration:5*1e3}),Promise.reject(new Error(t.message||"Business Error"))):e.status>=200&&e.status<300?t:(dn.error("收到意外的响应格式或状态"),Promise.reject(new Error("Unexpected response format or status")))},e=>{var t;if(console.error("Response error:",e),e.response){const n=e.response.status,o=((t=e.response.data)==null?void 0:t.message)||e.message||"请求失败";if(n===401)return dn.error("登录已过期或无效，请重新登录"),localStorage.removeItem("authToken"),window.location.href="/login",Promise.reject(new Error("Unauthorized"));if(n===403)return dn.error(o),Promise.reject(new Error("Forbidden"));dn.error(`${n}: ${o}`)}else e.request?dn.error("网络请求超时或无响应，请检查网络连接"):dn.error(`请求发送失败: ${e.message}`);return Promise.reject(e)});const Gd={get:(e,t)=>Vr.get(e,t),post:(e,t,n)=>Vr.post(e,t,n),put:(e,t,n)=>Vr.put(e,t,n),delete:(e,t)=>Vr.delete(e,t),patch:(e,t,n)=>Vr.patch(e,t,n)},xE=e=>!e||!Array.isArray(e)?[]:e.map(t=>({id:t.id,name:t.name,parentId:t.parentId===void 0?null:t.parentId,code:t.code,level:t.level,sortOrder:t.sortOrder,status:t.status,createdAt:t.createdAt,updatedAt:t.updatedAt,children:xE(t.children)})),wee=async()=>{try{const e=await Gd.get("/departments/tree");return xE(e||[])}catch(e){return console.error("API Error fetching department tree:",e),dn.error("获取部门树失败"),[]}},Cee=e=>Gd.post("/departments",e),See=(e,t)=>Gd.put(`/departments/${e}`,t),_ee=e=>Gd.delete(`/departments/${e}`),RE=6048e5,kee=864e5,PE=6e4,IE=36e5,Jb=Symbol.for("constructDateFrom");function La(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&Jb in e?e[Jb](t):e instanceof Date?new e.constructor(t):new Date(t)}function go(e,t){return La(t||e,e)}let Eee={};function Xd(){return Eee}function Ui(e,t){var i,u,c,d;const n=Xd(),o=(t==null?void 0:t.weekStartsOn)??((u=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:u.weekStartsOn)??n.weekStartsOn??((d=(c=n.locale)==null?void 0:c.options)==null?void 0:d.weekStartsOn)??0,a=go(e,t==null?void 0:t.in),r=a.getDay(),l=(r<o?7:0)+r-o;return a.setDate(a.getDate()-l),a.setHours(0,0,0,0),a}function Zc(e,t){return Ui(e,{...t,weekStartsOn:1})}function AE(e,t){const n=go(e,t==null?void 0:t.in),o=n.getFullYear(),a=La(n,0);a.setFullYear(o+1,0,4),a.setHours(0,0,0,0);const r=Zc(a),l=La(n,0);l.setFullYear(o,0,4),l.setHours(0,0,0,0);const i=Zc(l);return n.getTime()>=r.getTime()?o+1:n.getTime()>=i.getTime()?o:o-1}function Zb(e){const t=go(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function Tee(e,...t){const n=La.bind(null,t.find(o=>typeof o=="object"));return t.map(n)}function Qb(e,t){const n=go(e,t==null?void 0:t.in);return n.setHours(0,0,0,0),n}function $ee(e,t,n){const[o,a]=Tee(n==null?void 0:n.in,e,t),r=Qb(o),l=Qb(a),i=+r-Zb(r),u=+l-Zb(l);return Math.round((i-u)/kee)}function Oee(e,t){const n=AE(e,t),o=La(e,0);return o.setFullYear(n,0,4),o.setHours(0,0,0,0),Zc(o)}function Mee(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Nee(e){return!(!Mee(e)&&typeof e!="number"||isNaN(+go(e)))}function xee(e,t){const n=go(e,t==null?void 0:t.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const Ree={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Pee=(e,t,n)=>{let o;const a=Ree[e];return typeof a=="string"?o=a:t===1?o=a.one:o=a.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+o:o+" ago":o};function Yf(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const Iee={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Aee={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Lee={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Dee={date:Yf({formats:Iee,defaultWidth:"full"}),time:Yf({formats:Aee,defaultWidth:"full"}),dateTime:Yf({formats:Lee,defaultWidth:"full"})},Bee={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Fee=(e,t,n,o)=>Bee[e];function zs(e){return(t,n)=>{const o=n!=null&&n.context?String(n.context):"standalone";let a;if(o==="formatting"&&e.formattingValues){const l=e.defaultFormattingWidth||e.defaultWidth,i=n!=null&&n.width?String(n.width):l;a=e.formattingValues[i]||e.formattingValues[l]}else{const l=e.defaultWidth,i=n!=null&&n.width?String(n.width):e.defaultWidth;a=e.values[i]||e.values[l]}const r=e.argumentCallback?e.argumentCallback(t):t;return a[r]}}const Vee={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Hee={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},zee={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Kee={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Wee={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},jee={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Uee=(e,t)=>{const n=Number(e),o=n%100;if(o>20||o<10)switch(o%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},qee={ordinalNumber:Uee,era:zs({values:Vee,defaultWidth:"wide"}),quarter:zs({values:Hee,defaultWidth:"wide",argumentCallback:e=>e-1}),month:zs({values:zee,defaultWidth:"wide"}),day:zs({values:Kee,defaultWidth:"wide"}),dayPeriod:zs({values:Wee,defaultWidth:"wide",formattingValues:jee,defaultFormattingWidth:"wide"})};function Ks(e){return(t,n={})=>{const o=n.width,a=o&&e.matchPatterns[o]||e.matchPatterns[e.defaultMatchWidth],r=t.match(a);if(!r)return null;const l=r[0],i=o&&e.parsePatterns[o]||e.parsePatterns[e.defaultParseWidth],u=Array.isArray(i)?Gee(i,f=>f.test(l)):Yee(i,f=>f.test(l));let c;c=e.valueCallback?e.valueCallback(u):u,c=n.valueCallback?n.valueCallback(c):c;const d=t.slice(l.length);return{value:c,rest:d}}}function Yee(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n}function Gee(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n}function Xee(e){return(t,n={})=>{const o=t.match(e.matchPattern);if(!o)return null;const a=o[0],r=t.match(e.parsePattern);if(!r)return null;let l=e.valueCallback?e.valueCallback(r[0]):r[0];l=n.valueCallback?n.valueCallback(l):l;const i=t.slice(a.length);return{value:l,rest:i}}}const Jee=/^(\d+)(th|st|nd|rd)?/i,Zee=/\d+/i,Qee={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ete={any:[/^b/i,/^(a|c)/i]},tte={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},nte={any:[/1/i,/2/i,/3/i,/4/i]},ote={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ate={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},rte={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},lte={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ste={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ite={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ute={ordinalNumber:Xee({matchPattern:Jee,parsePattern:Zee,valueCallback:e=>parseInt(e,10)}),era:Ks({matchPatterns:Qee,defaultMatchWidth:"wide",parsePatterns:ete,defaultParseWidth:"any"}),quarter:Ks({matchPatterns:tte,defaultMatchWidth:"wide",parsePatterns:nte,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Ks({matchPatterns:ote,defaultMatchWidth:"wide",parsePatterns:ate,defaultParseWidth:"any"}),day:Ks({matchPatterns:rte,defaultMatchWidth:"wide",parsePatterns:lte,defaultParseWidth:"any"}),dayPeriod:Ks({matchPatterns:ste,defaultMatchWidth:"any",parsePatterns:ite,defaultParseWidth:"any"})},cte={code:"en-US",formatDistance:Pee,formatLong:Dee,formatRelative:Fee,localize:qee,match:ute,options:{weekStartsOn:0,firstWeekContainsDate:1}};function dte(e,t){const n=go(e,t==null?void 0:t.in);return $ee(n,xee(n))+1}function fte(e,t){const n=go(e,t==null?void 0:t.in),o=+Zc(n)-+Oee(n);return Math.round(o/RE)+1}function LE(e,t){var d,f,p,h;const n=go(e,t==null?void 0:t.in),o=n.getFullYear(),a=Xd(),r=(t==null?void 0:t.firstWeekContainsDate)??((f=(d=t==null?void 0:t.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??a.firstWeekContainsDate??((h=(p=a.locale)==null?void 0:p.options)==null?void 0:h.firstWeekContainsDate)??1,l=La((t==null?void 0:t.in)||e,0);l.setFullYear(o+1,0,r),l.setHours(0,0,0,0);const i=Ui(l,t),u=La((t==null?void 0:t.in)||e,0);u.setFullYear(o,0,r),u.setHours(0,0,0,0);const c=Ui(u,t);return+n>=+i?o+1:+n>=+c?o:o-1}function pte(e,t){var i,u,c,d;const n=Xd(),o=(t==null?void 0:t.firstWeekContainsDate)??((u=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:u.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(c=n.locale)==null?void 0:c.options)==null?void 0:d.firstWeekContainsDate)??1,a=LE(e,t),r=La((t==null?void 0:t.in)||e,0);return r.setFullYear(a,0,o),r.setHours(0,0,0,0),Ui(r,t)}function hte(e,t){const n=go(e,t==null?void 0:t.in),o=+Ui(n,t)-+pte(n,t);return Math.round(o/RE)+1}function Kt(e,t){const n=e<0?"-":"",o=Math.abs(e).toString().padStart(t,"0");return n+o}const Za={y(e,t){const n=e.getFullYear(),o=n>0?n:1-n;return Kt(t==="yy"?o%100:o,t.length)},M(e,t){const n=e.getMonth();return t==="M"?String(n+1):Kt(n+1,2)},d(e,t){return Kt(e.getDate(),t.length)},a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(e,t){return Kt(e.getHours()%12||12,t.length)},H(e,t){return Kt(e.getHours(),t.length)},m(e,t){return Kt(e.getMinutes(),t.length)},s(e,t){return Kt(e.getSeconds(),t.length)},S(e,t){const n=t.length,o=e.getMilliseconds(),a=Math.trunc(o*Math.pow(10,n-3));return Kt(a,t.length)}},Sl={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},e1={G:function(e,t,n){const o=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(o,{width:"abbreviated"});case"GGGGG":return n.era(o,{width:"narrow"});case"GGGG":default:return n.era(o,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){const o=e.getFullYear(),a=o>0?o:1-o;return n.ordinalNumber(a,{unit:"year"})}return Za.y(e,t)},Y:function(e,t,n,o){const a=LE(e,o),r=a>0?a:1-a;if(t==="YY"){const l=r%100;return Kt(l,2)}return t==="Yo"?n.ordinalNumber(r,{unit:"year"}):Kt(r,t.length)},R:function(e,t){const n=AE(e);return Kt(n,t.length)},u:function(e,t){const n=e.getFullYear();return Kt(n,t.length)},Q:function(e,t,n){const o=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(o);case"QQ":return Kt(o,2);case"Qo":return n.ordinalNumber(o,{unit:"quarter"});case"QQQ":return n.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(o,{width:"wide",context:"formatting"})}},q:function(e,t,n){const o=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(o);case"qq":return Kt(o,2);case"qo":return n.ordinalNumber(o,{unit:"quarter"});case"qqq":return n.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(o,{width:"wide",context:"standalone"})}},M:function(e,t,n){const o=e.getMonth();switch(t){case"M":case"MM":return Za.M(e,t);case"Mo":return n.ordinalNumber(o+1,{unit:"month"});case"MMM":return n.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(o,{width:"wide",context:"formatting"})}},L:function(e,t,n){const o=e.getMonth();switch(t){case"L":return String(o+1);case"LL":return Kt(o+1,2);case"Lo":return n.ordinalNumber(o+1,{unit:"month"});case"LLL":return n.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(o,{width:"wide",context:"standalone"})}},w:function(e,t,n,o){const a=hte(e,o);return t==="wo"?n.ordinalNumber(a,{unit:"week"}):Kt(a,t.length)},I:function(e,t,n){const o=fte(e);return t==="Io"?n.ordinalNumber(o,{unit:"week"}):Kt(o,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getDate(),{unit:"date"}):Za.d(e,t)},D:function(e,t,n){const o=dte(e);return t==="Do"?n.ordinalNumber(o,{unit:"dayOfYear"}):Kt(o,t.length)},E:function(e,t,n){const o=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(o,{width:"short",context:"formatting"});case"EEEE":default:return n.day(o,{width:"wide",context:"formatting"})}},e:function(e,t,n,o){const a=e.getDay(),r=(a-o.weekStartsOn+8)%7||7;switch(t){case"e":return String(r);case"ee":return Kt(r,2);case"eo":return n.ordinalNumber(r,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,o){const a=e.getDay(),r=(a-o.weekStartsOn+8)%7||7;switch(t){case"c":return String(r);case"cc":return Kt(r,t.length);case"co":return n.ordinalNumber(r,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){const o=e.getDay(),a=o===0?7:o;switch(t){case"i":return String(a);case"ii":return Kt(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(o,{width:"short",context:"formatting"});case"iiii":default:return n.day(o,{width:"wide",context:"formatting"})}},a:function(e,t,n){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){const o=e.getHours();let a;switch(o===12?a=Sl.noon:o===0?a=Sl.midnight:a=o/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){const o=e.getHours();let a;switch(o>=17?a=Sl.evening:o>=12?a=Sl.afternoon:o>=4?a=Sl.morning:a=Sl.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){let o=e.getHours()%12;return o===0&&(o=12),n.ordinalNumber(o,{unit:"hour"})}return Za.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getHours(),{unit:"hour"}):Za.H(e,t)},K:function(e,t,n){const o=e.getHours()%12;return t==="Ko"?n.ordinalNumber(o,{unit:"hour"}):Kt(o,t.length)},k:function(e,t,n){let o=e.getHours();return o===0&&(o=24),t==="ko"?n.ordinalNumber(o,{unit:"hour"}):Kt(o,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):Za.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getSeconds(),{unit:"second"}):Za.s(e,t)},S:function(e,t){return Za.S(e,t)},X:function(e,t,n){const o=e.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return n1(o);case"XXXX":case"XX":return Lr(o);case"XXXXX":case"XXX":default:return Lr(o,":")}},x:function(e,t,n){const o=e.getTimezoneOffset();switch(t){case"x":return n1(o);case"xxxx":case"xx":return Lr(o);case"xxxxx":case"xxx":default:return Lr(o,":")}},O:function(e,t,n){const o=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+t1(o,":");case"OOOO":default:return"GMT"+Lr(o,":")}},z:function(e,t,n){const o=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+t1(o,":");case"zzzz":default:return"GMT"+Lr(o,":")}},t:function(e,t,n){const o=Math.trunc(+e/1e3);return Kt(o,t.length)},T:function(e,t,n){return Kt(+e,t.length)}};function t1(e,t=""){const n=e>0?"-":"+",o=Math.abs(e),a=Math.trunc(o/60),r=o%60;return r===0?n+String(a):n+String(a)+t+Kt(r,2)}function n1(e,t){return e%60===0?(e>0?"-":"+")+Kt(Math.abs(e)/60,2):Lr(e,t)}function Lr(e,t=""){const n=e>0?"-":"+",o=Math.abs(e),a=Kt(Math.trunc(o/60),2),r=Kt(o%60,2);return n+a+t+r}const o1=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},DE=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},vte=(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],o=n[1],a=n[2];if(!a)return o1(e,t);let r;switch(o){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;case"PPPP":default:r=t.dateTime({width:"full"});break}return r.replace("{{date}}",o1(o,t)).replace("{{time}}",DE(a,t))},mte={p:DE,P:vte},gte=/^D+$/,yte=/^Y+$/,bte=["D","DD","YY","YYYY"];function wte(e){return gte.test(e)}function Cte(e){return yte.test(e)}function Ste(e,t,n){const o=_te(e,t,n);if(console.warn(o),bte.includes(e))throw new RangeError(o)}function _te(e,t,n){const o=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${o} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const kte=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ete=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Tte=/^'([^]*?)'?$/,$te=/''/g,Ote=/[a-zA-Z]/;function Mte(e,t,n){var d,f,p,h;const o=Xd(),a=o.locale??cte,r=o.firstWeekContainsDate??((f=(d=o.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??1,l=o.weekStartsOn??((h=(p=o.locale)==null?void 0:p.options)==null?void 0:h.weekStartsOn)??0,i=go(e,n==null?void 0:n.in);if(!Nee(i))throw new RangeError("Invalid time value");let u=t.match(Ete).map(m=>{const v=m[0];if(v==="p"||v==="P"){const y=mte[v];return y(m,a.formatLong)}return m}).join("").match(kte).map(m=>{if(m==="''")return{isToken:!1,value:"'"};const v=m[0];if(v==="'")return{isToken:!1,value:Nte(m)};if(e1[v])return{isToken:!0,value:m};if(v.match(Ote))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:m}});a.localize.preprocessor&&(u=a.localize.preprocessor(i,u));const c={firstWeekContainsDate:r,weekStartsOn:l,locale:a};return u.map(m=>{if(!m.isToken)return m.value;const v=m.value;(Cte(v)||wte(v))&&Ste(v,t,String(e));const y=e1[v[0]];return y(i,v,a.localize,c)}).join("")}function Nte(e){const t=e.match(Tte);return t?t[1].replace($te,"'"):e}function xte(e,t){const n=()=>La(t==null?void 0:t.in,NaN),a=Ate(e);let r;if(a.date){const c=Lte(a.date,2);r=Dte(c.restDateString,c.year)}if(!r||isNaN(+r))return n();const l=+r;let i=0,u;if(a.time&&(i=Bte(a.time),isNaN(i)))return n();if(a.timezone){if(u=Fte(a.timezone),isNaN(u))return n()}else{const c=new Date(l+i),d=go(0,t==null?void 0:t.in);return d.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),d.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),d}return go(l+i+u,t==null?void 0:t.in)}const Ku={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Rte=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Pte=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ite=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ate(e){const t={},n=e.split(Ku.dateTimeDelimiter);let o;if(n.length>2)return t;if(/:/.test(n[0])?o=n[0]:(t.date=n[0],o=n[1],Ku.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Ku.timeZoneDelimiter)[0],o=e.substr(t.date.length,e.length))),o){const a=Ku.timezone.exec(o);a?(t.time=o.replace(a[1],""),t.timezone=a[1]):t.time=o}return t}function Lte(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),o=e.match(n);if(!o)return{year:NaN,restDateString:""};const a=o[1]?parseInt(o[1]):null,r=o[2]?parseInt(o[2]):null;return{year:r===null?a:r*100,restDateString:e.slice((o[1]||o[2]).length)}}function Dte(e,t){if(t===null)return new Date(NaN);const n=e.match(Rte);if(!n)return new Date(NaN);const o=!!n[4],a=Ws(n[1]),r=Ws(n[2])-1,l=Ws(n[3]),i=Ws(n[4]),u=Ws(n[5])-1;if(o)return Wte(t,i,u)?Vte(t,i,u):new Date(NaN);{const c=new Date(0);return!zte(t,r,l)||!Kte(t,a)?new Date(NaN):(c.setUTCFullYear(t,r,Math.max(a,l)),c)}}function Ws(e){return e?parseInt(e):1}function Bte(e){const t=e.match(Pte);if(!t)return NaN;const n=Gf(t[1]),o=Gf(t[2]),a=Gf(t[3]);return jte(n,o,a)?n*IE+o*PE+a*1e3:NaN}function Gf(e){return e&&parseFloat(e.replace(",","."))||0}function Fte(e){if(e==="Z")return 0;const t=e.match(Ite);if(!t)return 0;const n=t[1]==="+"?-1:1,o=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return Ute(o,a)?n*(o*IE+a*PE):NaN}function Vte(e,t,n){const o=new Date(0);o.setUTCFullYear(e,0,4);const a=o.getUTCDay()||7,r=(t-1)*7+n+1-a;return o.setUTCDate(o.getUTCDate()+r),o}const Hte=[31,null,31,30,31,30,31,31,30,31,30,31];function BE(e){return e%400===0||e%4===0&&e%100!==0}function zte(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(Hte[t]||(BE(e)?29:28))}function Kte(e,t){return t>=1&&t<=(BE(e)?366:365)}function Wte(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function jte(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function Ute(e,t){return t>=0&&t<=59}const qte={class:"department-management-page"},Yte={class:"card-header"},Gte={class:"custom-tree-node"},Xte={class:"card-header"},Jte={key:0,class:"form-content"},Zte={class:"dialog-footer"},Qte=U({__name:"DepartmentManagement",setup(e){const t=I(),n=I(),o=I(),a=I(""),r=I([]),l=I(!1),i=I(null),u=I(!1),c=I(!1),d=I(!1),f=I("addTopLevel"),p=I(null),h=I("无 (顶级部门)"),m=bt({id:void 0,name:"",parentId:null,sortOrder:0}),v=bt({name:"",parentId:null,sortOrder:0}),y={children:"children",label:"name"},g={...y,disabled:"disabled"},_=S(()=>f.value==="addTopLevel"?"新增顶级部门":"新增子部门"),w=S(()=>{const P=(X,Q)=>X?X.map(q=>{let se=!1;q.id===Q&&(se=!0);const ce=q.children?P(q.children,Q):void 0,le=(j,ae)=>{if(!ae)return!1;if(j.parentId===ae)return!0;if(j.parentId===null||j.parentId===void 0)return!1;const oe=H(r.value,j.parentId);return oe?le(oe,ae):!1};return(q.id===m.id||le(q,m.id))&&(se=!0),{...q,id:q.id,name:q.name,children:ce,disabled:se}}):[],H=(X,Q)=>{if(!X)return null;for(const q of X){if(q.id===Q)return q;if(q.children){const se=H(q.children,Q);if(se)return se}}return null};return P(r.value,m.id)}),b=S(()=>!!m.id),C=bt({name:[{required:!0,message:"请输入部门名称",trigger:"blur"}]}),k=bt({name:[{required:!0,message:"请输入部门名称",trigger:"blur"}]}),T=P=>{if(!P)return"N/A";try{return Mte(xte(P),"yyyy-MM-dd HH:mm:ss")}catch(H){return console.error("Error parsing date:",P,H),P}},M=async()=>{l.value=!0;try{r.value=await wee(),console.log("Fetched department tree:",JSON.stringify(r.value,null,2)),i.value&&i.value.id!==void 0?O(i.value.id):(i.value=null,R())}catch(P){console.error("加载部门树失败:",P),dn.error("加载部门树失败"),r.value=[]}finally{l.value=!1}},O=P=>{const H=(Q,q)=>{for(const se of Q){if(se.id===q)return se;if(se.children){const ce=H(se.children,q);if(ce)return ce}}return null},X=H(r.value,P);X?(i.value={...X},m.id=X.id,m.name=X.name,m.parentId=X.parentId,m.sortOrder=X.sortOrder,console.log(`[DepartmentManagement] Assigned value to departmentForm.sortOrder: ${m.sortOrder}`),Be(()=>{var Q;(Q=n.value)==null||Q.clearValidate()})):(i.value=null,R())};fe(a,P=>{t.value.filter(P)});const N=(P,H)=>{var X;return P?(X=H.name)==null?void 0:X.includes(P):!0},A=P=>{console.log("Node clicked:",P),i.value={...P},m.id=P.id,m.name=P.name,m.parentId=P.parentId,m.sortOrder=P.sortOrder,Be(()=>{var H;(H=n.value)==null||H.clearValidate()})},R=()=>{var P;i.value?(m.id=i.value.id,m.name=i.value.name,m.parentId=i.value.parentId,m.sortOrder=i.value.sortOrder,Be(()=>{var H;(H=n.value)==null||H.clearValidate()})):(m.id=void 0,m.name="",m.parentId=null,m.sortOrder=0,(P=n.value)==null||P.resetFields())},W=async()=>{!n.value||!i.value||m.id===void 0||await n.value.validate(async P=>{if(P){u.value=!0;try{const H={name:m.name,parentId:m.parentId,sortOrder:m.sortOrder??0};await See(m.id,H),dn.success("部门信息保存成功"),await M()}catch(H){console.error("保存部门信息失败:",H),dn.error(H.message||"保存失败")}finally{u.value=!1}}})},J=()=>{var P;v.name="",v.parentId=null,v.sortOrder=0,(P=o.value)==null||P.resetFields()},V=()=>{J(),f.value="addTopLevel",p.value=null,h.value="无 (顶级部门)",c.value=!0},x=P=>{J(),f.value="addChild",p.value=P.id??null,h.value=P.name,v.parentId=P.id??null,c.value=!0},D=async()=>{o.value&&await o.value.validate(async P=>{if(P){d.value=!0;try{const H={name:v.name,parentId:p.value,sortOrder:v.sortOrder??0};console.log("[DepartmentManagement] Creating department with data:",JSON.stringify(H)),await Cee(H),dn.success("部门创建成功"),c.value=!1,await M()}catch(H){console.error("创建部门失败:",H),dn.error(H.message||"创建失败")}finally{d.value=!1}}})},L=async P=>{if(!P||P.id===void 0){dn.warning("无法删除：部门数据无效");return}if(P.children&&P.children.length>0){dn.warning("该部门下有子部门，请先删除子部门");return}try{await jk.confirm(`确定要删除部门 "${P.name}" 吗？此操作不可恢复。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),u.value=!0,await _ee(P.id),dn.success(`部门 "${P.name}" 删除成功`),i.value&&i.value.id===P.id&&(i.value=null,R()),await M()}catch(H){H!=="cancel"&&(console.error("删除部门失败:",H),dn.error(H.message||"删除失败"))}finally{u.value=!1}};return ot(()=>{M()}),(P,H)=>{const X=Xi("loading");return E(),F("div",qte,[z(s(r_),{gutter:20},{default:Y(()=>[z(s(Mp),{span:8},{default:Y(()=>[z(s(_p),{shadow:"never"},{header:Y(()=>[K("div",Yte,[H[10]||(H[10]=K("span",null,"部门列表",-1)),z(s(Gt),{type:"primary",icon:s(Mc),onClick:V},{default:Y(()=>H[9]||(H[9]=[rt("新增顶级部门")])),_:1},8,["icon"])])]),default:Y(()=>[z(s(on),{modelValue:a.value,"onUpdate:modelValue":H[0]||(H[0]=Q=>a.value=Q),placeholder:"输入关键字进行过滤",clearable:"",style:{"margin-bottom":"15px"}},null,8,["modelValue"]),et((E(),ue(s(Hi),{ref_key:"treeRef",ref:t,data:r.value,props:y,"node-key":"id","highlight-current":"","default-expand-all":"","expand-on-click-node":!1,"filter-node-method":N,onNodeClick:A},{default:Y(({node:Q,data:q})=>[K("span",Gte,[K("span",null,$e(Q.label),1),K("span",null,[z(s(Gt),{type:"primary",link:"",icon:s(Mc),onClick:qe(se=>x(q),["stop"])},{default:Y(()=>H[11]||(H[11]=[rt("新增子级")])),_:2},1032,["icon","onClick"]),z(s(Gt),{type:"danger",link:"",icon:s(gp),onClick:qe(se=>L(q),["stop"])},{default:Y(()=>H[12]||(H[12]=[rt("删除")])),_:2},1032,["icon","onClick"])])])]),_:1},8,["data"])),[[X,l.value]])]),_:1})]),_:1}),z(s(Mp),{span:16},{default:Y(()=>[z(s(_p),{shadow:"never"},{header:Y(()=>[K("div",Xte,[H[16]||(H[16]=K("span",null,"部门信息",-1)),K("div",null,[z(s(Gt),{icon:s(HC),onClick:R,disabled:!i.value},{default:Y(()=>H[13]||(H[13]=[rt(" 重置 ")])),_:1},8,["icon","disabled"]),z(s(Gt),{type:"danger",icon:s(gp),onClick:H[1]||(H[1]=Q=>L(i.value)),disabled:!i.value||!i.value.id,style:{"margin-left":"10px"}},{default:Y(()=>H[14]||(H[14]=[rt(" 删除 ")])),_:1},8,["icon","disabled"]),z(s(Gt),{type:"primary",icon:s(Cs),onClick:W,loading:u.value,disabled:!i.value||!i.value.id,style:{"margin-left":"10px"}},{default:Y(()=>H[15]||(H[15]=[rt(" 保存 ")])),_:1},8,["icon","loading","disabled"])])])]),default:Y(()=>[i.value?(E(),F("div",Jte,[z(s(Kp),{ref_key:"formRef",ref:n,model:m,rules:C,"label-width":"100px"},{default:Y(()=>[z(s(wa),{label:"部门名称",prop:"name"},{default:Y(()=>[z(s(on),{modelValue:m.name,"onUpdate:modelValue":H[2]||(H[2]=Q=>m.name=Q),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),z(s(wa),{label:"上级部门",prop:"parentId"},{default:Y(()=>[z(s(kk),{modelValue:m.parentId,"onUpdate:modelValue":H[3]||(H[3]=Q=>m.parentId=Q),data:w.value,props:g,"node-key":"id","check-strictly":"",filterable:"",clearable:"",placeholder:"选择上级部门 (不选为顶级)",style:{width:"100%"},"render-after-expand":!1,disabled:b.value},null,8,["modelValue","data","disabled"])]),_:1}),z(s(wa),{label:"排序号",prop:"sortOrder"},{default:Y(()=>[z(s(Lc),{modelValue:m.sortOrder,"onUpdate:modelValue":H[4]||(H[4]=Q=>m.sortOrder=Q),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),z(s(wa),{label:"创建时间"},{default:Y(()=>[z(s(on),{value:T(i.value.createdAt),disabled:""},null,8,["value"])]),_:1}),z(s(wa),{label:"更新时间"},{default:Y(()=>[z(s(on),{value:T(i.value.updatedAt),disabled:""},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])])):(E(),ue(s(lm),{key:1,description:"请在左侧选择一个部门进行查看或编辑"}))]),_:1})]),_:1})]),_:1}),z(s(P2),{modelValue:c.value,"onUpdate:modelValue":H[8]||(H[8]=Q=>c.value=Q),title:_.value,width:"500px",onClosed:J},{footer:Y(()=>[K("span",Zte,[z(s(Gt),{onClick:H[7]||(H[7]=Q=>c.value=!1)},{default:Y(()=>H[17]||(H[17]=[rt("取消")])),_:1}),z(s(Gt),{type:"primary",onClick:D,loading:d.value},{default:Y(()=>H[18]||(H[18]=[rt("确定")])),_:1},8,["loading"])])]),default:Y(()=>[z(s(Kp),{ref_key:"dialogFormRef",ref:o,model:v,rules:k,"label-width":"100px"},{default:Y(()=>[z(s(wa),{label:"部门名称",prop:"name"},{default:Y(()=>[z(s(on),{modelValue:v.name,"onUpdate:modelValue":H[5]||(H[5]=Q=>v.name=Q),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),z(s(wa),{label:"上级部门"},{default:Y(()=>[z(s(on),{value:h.value,disabled:""},null,8,["value"])]),_:1}),z(s(wa),{label:"排序号",prop:"sortOrder"},{default:Y(()=>[z(s(Lc),{modelValue:v.sortOrder,"onUpdate:modelValue":H[6]||(H[6]=Q=>v.sortOrder=Q),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),ene=Km(Qte,[["__scopeId","data-v-f9820d86"]]),tne=()=>{const e=localStorage.getItem("userInfo");try{return e?JSON.parse(e):null}catch(t){return console.error("无法解析存储的用户信息:",t),localStorage.removeItem("userInfo"),localStorage.removeItem("authToken"),null}},nne=[{path:"/",redirect:"/dashboard",component:WZ,children:[{path:"dashboard",name:"Dashboard",component:()=>Xa(()=>import("./DashboardView-CB0mdZcN.js"),__vite__mapDeps([0,1,2])),meta:{title:"仪表盘",requiresAuth:!0}},{path:"documents",name:"DocumentList",component:()=>Xa(()=>import("./DocumentListView-Ckn2zykp.js"),__vite__mapDeps([3,4,5,6])),meta:{title:"文档管理",requiresAuth:!0}},{path:"doc-types",name:"DocTypeList",component:()=>Xa(()=>import("./DocTypeListView-BoWjwWdM.js"),__vite__mapDeps([7,4,8])),meta:{title:"文档类型管理",requiresAuth:!0}},{path:"users",name:"UserList",component:()=>Xa(()=>import("./UserListView-l379mF4v.js"),__vite__mapDeps([9,10])),meta:{title:"用户管理",requiresAuth:!0}},{path:"departments",name:"DepartmentManagement",component:ene,meta:{title:"部门管理",requiresAuth:!0}},{path:"settings",name:"Settings",component:()=>Xa(()=>import("./SettingsView-BFL6DaCm.js"),__vite__mapDeps([11,12])),meta:{title:"操作日志",requiresAuth:!0,roles:["admin"]}},{path:"export-tasks",name:"ExportTaskList",component:()=>Xa(()=>import("./ExportTaskList-rAFeD83A.js"),__vite__mapDeps([13,5,14])),meta:{title:"导出任务",requiresAuth:!0}},{path:"statistics",name:"Statistics",component:()=>Xa(()=>import("./StatisticsView-DI5sj6Pr.js"),__vite__mapDeps([15,1,16])),meta:{title:"统计报表",requiresAuth:!0}}]},{path:"/login",name:"Login",component:()=>Xa(()=>import("./LoginView-CuMyLRdx.js"),__vite__mapDeps([17,18])),meta:{title:"登录"}}],FE=PZ({history:iZ("/"),routes:nne});FE.beforeEach((e,t,n)=>{const o=!!localStorage.getItem("authToken"),a=e.matched.some(l=>l.meta.requiresAuth),r=e.meta.roles;if(console.log(`路由守卫: 前往 ${e.path}, 需要认证: ${a}, 需要角色: ${r}, 已认证: ${o}`),a&&!o)console.log("未认证，重定向到登录页"),n({name:"Login",query:{redirect:e.fullPath}});else if(e.name==="Login"&&o)console.log("已认证，访问登录页，重定向到仪表盘"),n({name:"Dashboard"});else if(a&&o&&r){const l=tne(),i=l==null?void 0:l.role;i?r.includes(i)?(console.log(`角色 '${i}' 满足要求 [${r.join(", ")}]，放行`),n()):(console.warn(`角色 '${i}' 不满足要求 [${r.join(", ")}]，阻止导航`),dn.warning("抱歉，您没有权限访问该页面"),n(!1)):(console.error("已认证但无法获取用户角色信息，可能需要重新登录"),localStorage.removeItem("userInfo"),localStorage.removeItem("authToken"),dn.error("用户角色信息丢失，请重新登录"),n({name:"Login"}))}else console.log("不需要特定角色或无需认证，放行"),n()});const one=U({__name:"App",setup(e){return(t,n)=>{const o=ut("router-view");return E(),ue(o)}}}),ane=Km(one,[["__scopeId","data-v-e0580ea2"]]),qm=xw(ane);qm.use(FE);qm.use(MJ);qm.mount("#app");export{ua as $,kk as A,r_ as B,I2 as C,u7 as D,dn as E,He as F,c7 as G,ts as H,_G as I,jk as J,Lt as K,fe as L,It as M,xt as N,ht as O,lm as P,xV as Q,NV as R,$ as S,mr as T,Le as U,Gn as V,OS as W,pI as X,KC as Y,vP as Z,Km as _,_r as a,pP as a0,mz as a1,Y2 as a2,Xa as a3,qe as a4,wa as a5,CD as a6,YS as a7,HS as a8,Mo as a9,wV as aA,s2 as aB,fK as aC,Wa as aD,Ke as aE,sne as aF,AZ as aG,fne as aa,wee as ab,YP as ac,dne as ad,Mc as ae,uI as af,ine as ag,une as ah,gp as ai,RK as aj,_p as ak,Hi as al,Lc as am,HC as an,Cs as ao,al as ap,Dc as aq,QW as ar,cne as as,Mte as at,xte as au,xp as av,Q2 as aw,Ca as ax,XP as ay,r2 as az,et as b,Xi as c,U as d,F as e,z as f,Y as g,ut as h,E as i,K as j,rt as k,bt as l,S as m,Be as n,ot as o,ue as p,P2 as q,I as r,re as s,$e as t,s as u,Kp as v,Gd as w,Mp as x,on as y,Gt as z};
/usr/share/nginx/html/assets/DocumentListView-Ckn2zykp.js:import{w as ne,d as xe,r as p,l as Ce,m as te,p as K,g as a,u as e,q as Ne,n as be,E as h,i as I,b as Ee,e as A,s as re,c as Re,v as Le,f as l,x as oe,h as pe,y as H,z as M,k as b,F as ke,A as Fe,B as he,j as C,C as Ye,D as Qe,G as ye,t as G,H as He,I as Ke,J as Ze,_ as Te,K as tl,L as Se,o as Xe,M as ol,N as rl,O as Pe,P as nl,Q as Ie,R as sl,S as Ve,T as Ae,U as ee,V as Me,W as We,X as il,Y as je,Z as Ue,$ as dl,a0 as Ge,a1 as ul,a2 as cl,a3 as Oe,a4 as pl,a5 as $e,a6 as qe,a7 as _e,a8 as ml,a9 as fl,aa as el,ab as vl,ac as gl,ad as yl,ae as bl,af as hl,ag as Dl,ah as wl,ai as _l,aj as kl}from"./index-CBvB2BG7.js";import{g as xl}from"./doctype-CZXNoMjw.js";import{r as Tl,a as Il}from"./task-CD3nn-Wg.js";const Vl=(F,S)=>{if(!(F instanceof Blob)){console.error("[downloadBlob] Invalid Blob object received.");return}const $=window.URL.createObjectURL(F),P=document.createElement("a");P.style.display="none",P.href=$,P.download=S,document.body.appendChild(P);try{P.click()}catch(W){console.error("[downloadBlob] Failed to trigger download click:",W)}document.body.removeChild(P),window.URL.revokeObjectURL($),console.log(`[downloadBlob] Download triggered for ${S}, Blob URL revoked.`)},Cl=async F=>{console.log("[api/document.ts:getDocuments] Entry. Received params:",JSON.stringify(F,null,2));try{console.log("[api/document.ts:getDocuments] Params BEFORE passing to request util:",JSON.stringify(F,null,2));const S=await ne.get("/documents",{params:F});return console.log("[api/document.ts] Response from wrappedRequest.get (should be PageResult):",S),S||{list:[],total:0}}catch(S){return console.error("[api/document.ts] Error in getDocuments:",S),{list:[],total:0}}},El=async F=>await ne.post("/documents",F),Fl=async(F,S)=>await ne.put(`/documents/${F}`,S),Nl=async F=>{await ne.delete(`/documents/${F}`)},ll=async F=>await ne.get(`/documents/${F}`),Sl=async(F,S)=>await ne.post(`/documents/${F}/files`,S),$l=async F=>{await ne.delete(`/documents/${F}/files`)},Pl=async F=>await ne.post(`/documents/${F}/start-processing`),al=async(F,S)=>{try{const $=await ne.get(`/documents/files/${F}/download`,{responseType:"blob"});Vl($,S)}catch($){throw console.error(`[api/document.ts] Error downloading file ${F}:`,$),$}},Je=async F=>{try{const S=await ne.get(`/documents/files/${F}/download`,{responseType:"blob"});if(S instanceof Blob)return S;throw console.error("Expected Blob but received:",S),new Error("无法获取文件 Blob 数据，响应类型不匹配")}catch(S){throw console.error(`Error fetching file blob for preview (ID: ${F}):`,S),new Error("获取文件预览失败")}},Ul={key:0,class:"file-management-area"},Rl={style:{"margin-top":"20px"}},Ll={class:"el-upload__tip"},zl={key:0,style:{color:"red","margin-left":"10px"}},Bl={style:{"margin-top":"15px","text-align":"right"}},Al={class:"dialog-footer"},Ml=xe({__name:"DocumentFormDialog",props:{docTypeTreeData:{},departmentTreeData:{}},emits:["success"],setup(F,{expose:S,emit:$}){const P=F,W=$,V=p(!1),g=p(!1),Y=p(),i=p("add"),E=p(null),L=p(!1),B=p(!1),z=p(!1),O=p(!1),le=()=>({doc_name:"",docTypeId:null,docTypeName:"",sourceDepartmentId:null,sourceDepartmentName:"",submitter:"",receiver:"",signer:null,storageLocation:null,handoverDate:void 0,remarks:""});let m=Ce(le());const N=p([]),d=p(!1),D=p([]),R=p(),x=te(()=>i.value==="view"),k=te(()=>i.value==="add"?"新增文档":i.value==="edit"?"编辑文档":"查看文档信息"),q={value:"id",label:"name",children:"children"},y=te(()=>N.value.some(r=>r.processingStatus==="pending")),T=te(()=>{const r=localStorage.getItem("authToken");return r?{Authorization:`Bearer ${r}`}:{}}),Q=Ce({doc_name:[{required:!0,message:"请输入文档名称",trigger:"blur"}],submitter:[{required:!0,message:"请输入提交人",trigger:"blur"}],receiver:[{required:!0,message:"请输入接收人",trigger:"blur"}],signer:[{max:50,message:"签章人名称过长",trigger:"blur"}],storageLocation:[{max:100,message:"存放位置过长",trigger:"blur"}],remarks:[{max:1e3,message:"备注过长",trigger:"blur"}]}),J=p({}),Z=(r,t)=>{var _;console.log("[Dialog] Open called with type:",r,"and data:",t),i.value=r,V.value=!0,g.value=!1,E.value=null,N.value=[],D.value=[],(_=R.value)==null||_.clearFiles(),L.value=r==="add",B.value=r==="add",z.value=!1,O.value=!1;const w=f=>{if(f==null||f==="")return null;if(typeof f=="number")return f;const c=parseInt(f,10);return isNaN(c)?null:c};be(async()=>{var f,c;if((f=Y.value)==null||f.resetFields(),Object.assign(m,le()),(r==="edit"||r==="view")&&t&&t.id){const v=t.id;E.value=v,d.value=!0,g.value=!0;try{console.log(`[Dialog] Fetching details for document ID: ${v} (Mode: ${r})`);const o=await ll(v);if(o){m.doc_name=o.docName??"",m.submitter=o.submitter??"",m.receiver=o.receiver??"",m.signer=o.signer??null,m.storageLocation=o.storageLocation??null,m.handoverDate=o.handoverDate??void 0,m.remarks=o.remarks??"",m.sourceDepartmentId=w(o.sourceDepartmentId),m.sourceDepartmentName=o.sourceDepartmentName??null;const n=w(o.docTypeId),j=(c=P.docTypeTreeData)==null?void 0:c.some(U=>se(U,n));m.docTypeId=j?n:null,m.docTypeName=j?o.docTypeName??null:null,r==="edit"?(N.value=o.files||[],console.log("[Dialog] Associated files updated for edit list:",N.value)):N.value=[]}else console.error(`[Dialog] Document details not found for ID: ${v}`),h.error("无法加载文档详情")}catch(o){console.error(`[Dialog] Error fetching details for ID ${v}:`,o),h.error("加载文档详情失败")}finally{g.value=!1}}else r==="add"&&(d.value=!1)})},se=(r,t)=>!r||t===null||t===void 0?!1:r.id===t?!0:r.children&&r.children.length>0?r.children.some(w=>se(w,t)):!1,X=r=>{m.docTypeId=r;const t=(_,f)=>{if(!_||f===null)return null;for(const c of _){if(c.id===f)return c;if(c.children&&c.children.length>0){const v=t(c.children,f);if(v)return v}}return null},w=t(P.docTypeTreeData,r);m.docTypeName=w?w.name:null,z.value=!0,console.log(`[Dialog] DocType changed. Selected ID: ${r}, Updated Name: ${m.docTypeName}, User Modified: ${z.value}`)},de=r=>{m.sourceDepartmentId=r;const t=(_,f)=>{if(!_||f===null)return null;for(const c of _){if(c.id===f)return c;if(c.children&&c.children.length>0){const v=t(c.children,f);if(v)return v}}return null},w=t(P.departmentTreeData,r);m.sourceDepartmentName=w?w.name:null,O.value=!0,console.log(`[Dialog] Department changed. Selected ID: ${r}, Updated Name: ${m.sourceDepartmentName}, User Modified: ${O.value}`)},me=async()=>{if(!(i.value==="view"||!Y.value))try{await Y.value.validate(),g.value=!0;let r={docName:m.doc_name,submitter:m.submitter,receiver:m.receiver,signer:m.signer??void 0,storageLocation:m.storageLocation??void 0,handoverDate:m.handoverDate,remarks:m.remarks};z.value&&(r.docTypeId=m.docTypeId),O.value&&(r.sourceDepartmentId=m.sourceDepartmentId);let t=null,w=!1;if(console.log("[Dialog] Submitting data:",r),i.value==="add"){const _=await El(r);if(_&&_.id)t=_.id,E.value=t,w=!0,h.success("文档新增成功");else throw new Error("创建文档后 未能获取到有效的文档 ID")}else i.value==="edit"&&E.value&&(await Fl(E.value,r),t=E.value,h.success("文档更新成功"));if(t&&D.value.length>0){console.log(`[handleSubmit] Document ${i.value} successful (ID: ${t}). Uploading ${D.value.length} selected files.`);try{await ie(t)}catch(_){console.error("[handleSubmit] Uploading files after save failed:",_),h.error("文 档信息已保存，但文件上传失败。")}}else if(t&&w&&y.value){console.log(`[handleSubmit] Document ${t} saved. Checking for pending files...`),console.log(`[handleSubmit] Pending files detected (canStartProcessing=${y.value}). Attempting to automatically start processing.`);try{await ge()}catch(_){console.error("[handleSubmit] Auto-triggering processing failed:",_),h.error("文档已保存，但自动触发文件处理失败。")}}else t&&console.log(`[handleSubmit] Document ${t} ${i.value} successful. No files selected for upload or no pending processing needed.`);V.value=!1,W("success")}catch(r){console.error("提交文档失败:",r),h.error(`操作失败: ${(r==null?void 0:r.message)||"请检查表单或联系管理员"}`)}finally{g.value=!1}},fe=()=>{g.value||(V.value=!1)},ve=(r,t)=>{h.warning(`当前限制选择 10 个文件，本次选择了 ${r.length} 个文件，共选择了 ${r.length+t.length} 个文件`)},ue=async()=>{var r;if(!(!E.value||N.value.length===0))try{await Ze.confirm("确定要清空该文档下的所有关联文件吗？此操作不可恢复。","警告",{confirmButtonText:"确定清空",cancelButtonText:"取消",type:"warning"}),g.value=!0,await $l(E.value),h.success("所有文件已清空"),N.value=[],D.value=[],(r=R.value)==null||r.clearFiles()}catch(t){t!=="cancel"&&(console.error("Clear all files error:",t),h.error(t.message||"清空文件失败"))}finally{g.value=!1}},ie=async r=>{var _;const t=r??E.value;if(!t||D.value.length===0)return;const w=new FormData;D.value.forEach(f=>{f.raw&&w.append("files",f.raw)}),g.value=!0;try{const f=await Sl(t,w);h.success("文件上传成功"),N.value=f.files||[],console.log("[Upload Success] Associated files updated:",JSON.parse(JSON.stringify(N.value))),D.value=[],(_=R.value)==null||_.clearFiles(),!r&&y.value&&(console.log("[handleUploadFiles] Standalone upload successful. Triggering processing."),await ge())}catch(f){throw console.error("Upload files error:",f),h.error(f.message||"文件上传失败"),f}finally{g.value=!1}},ge=async()=>{if(!E.value||!y.value){console.warn("[handleStartProcessing] No current ID or no processable files.");return}try{const r=await Pl(E.value);h.success(`已成功触发 ${r.triggeredCount} 个文件的处理任务`)}catch(r){throw console.error("Start processing error:",r),r}},De=r=>{if(!r)return"未知";const t=r.toLowerCase();return t.includes("pdf")?"PDF 文件":t.includes("wordprocessingml")||t.includes("msword")?"Word 文档":t.includes("spreadsheetml")||t.includes("excel")||t.includes("ms-excel")?"Excel 表格":t.includes("presentationml")||t.includes("powerpoint")||t.includes("ms-powerpoint")?"PPT 演示文稿":t.startsWith("image/jpeg")?"JPEG 图像":t.startsWith("image/png")?"PNG 图像":t.startsWith("image/gif")?"GIF 图像":t.startsWith("image/bmp")?"BMP 图像":t.startsWith("text/plain")?"纯文本":t.startsWith("application/zip")?"ZIP 压缩包":t.startsWith("application/x-rar-compressed")?"RAR 压缩包":t.split("/")[0]||"未知文件"},we=r=>{switch(r){case"pending":return"待处理";case"processing":return"处理中";case"completed":return"已完成";case"failed":return"处理失败";default:return"未知状态"}},u=r=>{switch(r){case"pending":return"warning";case"processing":return"info";case"completed":return"success";case"failed":return"danger";default:return"info"}},s=async r=>{if(!(!r||!r.id||!r.fileName)){J.value[r.id]=!0;try{await al(r.id,r.fileName)}catch(t){console.error("Download file error in edit:",t),h.error("下载文件失败")}finally{J.value[r.id]=!1}}};return S({open:Z}),(r,t)=>{const w=pe("el-form-item"),_=pe("el-date-picker"),f=Re("loading");return I(),K(e(Ne),{modelValue:V.value,"onUpdate:modelValue":t[11]||(t[11]=c=>V.value=c),title:k.value,width:"60%","before-close":fe,draggable:"","destroy-on-close":""},{footer:a(()=>[C("span",Al,[l(e(M),{onClick:fe},{default:a(()=>[b(G(x.value?"关闭":"取消"),1)]),_:1}),x.value?re("",!0):(I(),K(e(M),{key:0,type:"primary",onClick:me,loading:g.value},{default:a(()=>t[21]||(t[21]=[b("确定")])),_:1},8,["loading"]))])]),default:a(()=>[Ee((I(),K(e(Le),{ref_key:"formRef",ref:Y,model:e(m),rules:x.value?{}:Q,"label-width":"100px",disabled:x.value},{default:a(()=>[l(e(he),{gutter:20},{default:a(()=>[l(e(oe),{span:12},{default:a(()=>[l(w,{label:"文档名称",prop:"doc_name"},{default:a(()=>[l(e(H),{modelValue:e(m).doc_name,"onUpdate:modelValue":t[0]||(t[0]=c=>e(m).doc_name=c),placeholder:"请输入文档名称",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),l(e(oe),{span:12},{default:a(()=>[l(w,{label:"文档类型",prop:"docTypeName"},{default:a(()=>[x.value?(I(),K(e(H),{key:0,"model-value":e(m).docTypeName,disabled:"",placeholder:"---"},null,8,["model-value"])):L.value?(I(),K(e(Fe),{key:2,"model-value":e(m).docTypeId,"onUpdate:modelValue":X,placeholder:"请选择新文档类型",data:P.docTypeTreeData,props:q,"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"100%"}},null,8,["model-value","data"])):(I(),A(ke,{key:1},[l(e(H),{"model-value":e(m).docTypeName,disabled:"",placeholder:"未指定",style:{width:"calc(100% - 70px)","margin-right":"8px"}},null,8,["model-value"]),l(e(M),{onClick:t[1]||(t[1]=c=>L.value=!0),disabled:x.value},{default:a(()=>t[12]||(t[12]=[b("更改")])),_:1},8,["disabled"])],64))]),_:1})]),_:1})]),_:1}),l(e(he),{gutter:20},{default:a(()=>[l(e(oe),{span:12},{default:a(()=>[l(w,{label:"来源部门",prop:"sourceDepartmentName"},{default:a(()=>[x.value?(I(),K(e(H),{key:0,"model-value":e(m).sourceDepartmentName,disabled:"",placeholder:"---"},null,8,["model-value"])):B.value?(I(),K(e(Fe),{key:2,"model-value":e(m).sourceDepartmentId,"onUpdate:modelValue":de,placeholder:"请选择新来源部门",data:P.departmentTreeData,props:q,"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"100%"}},null,8,["model-value","data"])):(I(),A(ke,{key:1},[l(e(H),{"model-value":e(m).sourceDepartmentName,disabled:"",placeholder:"未指定",style:{width:"calc(100% - 70px)","margin-right":"8px"}},null,8,["model-value"]),l(e(M),{onClick:t[2]||(t[2]=c=>B.value=!0),disabled:x.value},{default:a(()=>t[13]||(t[13]=[b("更改")])),_:1},8,["disabled"])],64))]),_:1})]),_:1}),l(e(oe),{span:12},{default:a(()=>[l(w,{label:"交接日期",prop:"handoverDate"},{default:a(()=>[l(_,{modelValue:e(m).handoverDate,"onUpdate:modelValue":t[3]||(t[3]=c=>e(m).handoverDate=c),type:"date",placeholder:"选择交接日期","value-format":"YYYY-MM-DD",style:{width:"100%"},disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(e(he),{gutter:20},{default:a(()=>[l(e(oe),{span:12},{default:a(()=>[l(w,{label:"提交人",prop:"submitter"},{default:a(()=>[l(e(H),{modelValue:e(m).submitter,"onUpdate:modelValue":t[4]||(t[4]=c=>e(m).submitter=c),placeholder:"请输入提交人",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),l(e(oe),{span:12},{default:a(()=>[l(w,{label:"接收人",prop:"receiver"},{default:a(()=>[l(e(H),{modelValue:e(m).receiver,"onUpdate:modelValue":t[5]||(t[5]=c=>e(m).receiver=c),placeholder:"请输入接收人",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(e(he),{gutter:20},{default:a(()=>[l(e(oe),{span:12},{default:a(()=>[l(w,{label:"签署人",prop:"signer"},{default:a(()=>[l(e(H),{modelValue:e(m).signer,"onUpdate:modelValue":t[6]||(t[6]=c=>e(m).signer=c),placeholder:"请输入签署人 (可选)",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),l(e(oe),{span:12},{default:a(()=>[l(w,{label:"存放位置",prop:"storageLocation"},{default:a(()=>[l(e(H),{modelValue:e(m).storageLocation,"onUpdate:modelValue":t[7]||(t[7]=c=>e(m).storageLocation=c),placeholder:"请输入存放位置 (可选)",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(w,{label:"备注",prop:"remarks"},{default:a(()=>[l(e(H),{modelValue:e(m).remarks,"onUpdate:modelValue":t[8]||(t[8]=c=>e(m).remarks=c),type:"textarea",rows:3,placeholder:"请输入备注信息 (可选)",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","rules","disabled"])),[[f,g.value]]),x.value?re("",!0):(I(),A("div",Ul,[l(e(Ye),{"content-position":"left"},{default:a(()=>t[14]||(t[14]=[b("文件管理")])),_:1}),Ee((I(),K(e(Qe),{data:N.value,style:{width:"100%"},border:"",size:"small"},{default:a(()=>[l(e(ye),{type:"index",label:"序号",width:"60",align:"center"}),l(e(ye),{prop:"fileName",label:"文件名","show-overflow-tooltip":""}),l(e(ye),{prop:"fileType",label:"类型",width:"120"},{default:a(({row:c})=>[C("span",null,G(De(c.fileType)),1)]),_:1}),l(e(ye),{prop:"fileSize",label:"大小",width:"100"},{default:a(({row:c})=>[b(G((c.fileSize/1024).toFixed(2))+" KB ",1)]),_:1}),l(e(ye),{prop:"processingStatus",label:"状态",width:"100"},{default:a(({row:c})=>[l(e(He),{type:u(c.processingStatus),size:"small"},{default:a(()=>[b(G(we(c.processingStatus)),1)]),_:2},1032,["type"])]),_:1}),l(e(ye),{label:"操作",width:"100",align:"center"},{default:a(({row:c})=>[l(e(M),{type:"primary",link:"",size:"small",onClick:v=>s(c),loading:J.value[c.id]},{default:a(()=>t[15]||(t[15]=[b(" 下载 ")])),_:2},1032,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[f,g.value]]),C("div",Rl,[l(e(Ke),{ref_key:"uploadRef",ref:R,"file-list":D.value,"onUpdate:fileList":t[9]||(t[9]=c=>D.value=c),action:"","auto-upload":!1,multiple:"",limit:10,"on-exceed":ve,headers:T.value,"http-request":()=>{},"before-upload":()=>!g.value,disabled:g.value},{trigger:a(()=>[l(e(M),{type:"primary",disabled:g.value},{default:a(()=>t[16]||(t[16]=[b("选择文件")])),_:1},8,["disabled"])]),tip:a(()=>[C("div",Ll,[t[17]||(t[17]=b(" 支持 PDF, Word, JPG, PNG 等格式，最多上传 10 个文件。 ")),t[18]||(t[18]=C("span",{style:{color:"#e6a23c","margin-left":"5px"}},"注意：PDF、JPG、PNG 可直接预览，其他格式需下载后查看。",-1)),i.value==="edit"?(I(),A("span",zl,"注意：上传新文件将替换所有现有文件！")):re("",!0)])]),_:1},8,["file-list","headers","before-upload","disabled"])]),C("div",Bl,[l(e(M),{type:"danger",onClick:ue,disabled:N.value.length===0||g.value,loading:g.value},{default:a(()=>t[19]||(t[19]=[b(" 清空文件 ")])),_:1},8,["disabled","loading"]),l(e(M),{type:"success",onClick:t[10]||(t[10]=()=>ie()),disabled:D.value.length===0||g.value||i.value==="add",loading:g.value},{default:a(()=>t[20]||(t[20]=[b(" 上传选中文件 ")])),_:1},8,["disabled","loading"])])]))]),_:1},8,["modelValue","title"])}}}),Wl=Te(Ml,[["__scopeId","data-v-cefe5a42"]]),jl={key:0,class:"file-list-container"},Gl=["onClick"],Ol={class:"file-item-label"},ql={key:3,class:"selected-file-details"},Jl={class:"preview-area",style:{"margin-top":"15px","text-align":"center"}},Yl={key:0,class:"preview-placeholder"},Ql={key:1,class:"image-gallery-wrapper"},Hl=["onClick"],Kl={class:"thumbnail-container"},Zl=["src"],Xl={key:1,class:"thumbnail-placeholder"},ea=["onClick"],la={class:"thumbnail-footer"},aa={class:"file-type"},ta={class:"file-size"},oa={key:2,class:"pdf-preview-container"},ra={class:"pdf-toolbar"},na={class:"pdf-container"},sa={key:0,class:"pdf-loading-overlay"},ia={key:3,class:"file-action-card"},da={class:"icon-container"},ua={class:"action-info"},ca={class:"file-type"},pa={class:"dialog-footer"},ma=xe({__name:"DocumentFileViewDialog",setup(F,{expose:S}){const $=p(!1),P=p(!1),W=p(null),V=p([]),g=p(null),Y=p({}),i=p(!1),E=p({}),L=p(!1),B=p(0),z=p([]),O=te(()=>V.value.filter(o=>ve(o.fileType))),le=te(()=>O.value.length>0),m=p(null),N=p(!1),d=tl(null),D=p(1),R=p(0),x=p(1),k=p(null),q=p(!1),y=p(null),T=p(!1),Q=p(!0),J=p(!1),Z=async o=>{W.value=o,$.value=!0,P.value=!0,V.value=[],g.value=null,E.value={},d.value=null,D.value=1,R.value=0,x.value=1;try{const n=await ll(o);n&&n.files?(V.value=n.files,V.value.length>0&&(ie(V.value[0]),ge(V.value))):h.error("无法加载附件列表")}catch(n){console.error(`Error fetching files for document ID ${o}:`,n),h.error("加载附件列表失败")}finally{P.value=!1,be(()=>c())}},se=o=>{Object.values(E.value).forEach(n=>{n&&URL.revokeObjectURL(n)}),E.value={},d.value&&(d.value.destroy(),d.value=null),k.value&&(k.value.cancel(),k.value=null),$.value=!1,o&&o()},X=async o=>{if(!(!o||!o.id||!o.fileName)){Y.value[o.id]=!0;try{await al(o.id,o.fileName)}catch(n){console.error("Download file error:",n),h.error("下载文件失败")}finally{Y.value[o.id]=!1}}},de=o=>{if(!o)return"未知";const n=o.toLowerCase();return n.includes("pdf")?"PDF 文件":n.includes("wordprocessingml")||n.includes("msword")?"Word 文档":n.includes("spreadsheetml")||n.includes("excel")||n.includes("ms-excel")?"Excel 表格":n.includes("presentationml")||n.includes("powerpoint")||n.includes("ms-powerpoint")?"PPT 演示文稿":n.startsWith("image/jpeg")?"JPEG 图像":n.startsWith("image/png")?"PNG 图像":n.startsWith("image/gif")?"GIF 图像":n.startsWith("image/bmp")?"BMP 图像":n.startsWith("text/plain")?"纯文本":n.startsWith("application/zip")?"ZIP 压缩包":n.startsWith("application/x-rar-compressed")?"RAR 压缩包":n.split("/")[0]||"未知文件"},me=o=>{switch(o){case"pending":return"待处理";case"processing":return"处理中";case"completed":return"已完成";case"failed":return"处理失败";default:return"未知状态"}},fe=o=>{switch(o){case"pending":return"warning";case"processing":return"info";case"completed":return"success";case"failed":return"danger";default:return"info"}},ve=o=>{const n=o.toLowerCase();return n.startsWith("image/")&&n!=="image/bmp"},ue=o=>o==="application/pdf",ie=o=>{g.value=o,ue(o.fileType)?u(o.id):d.value&&(d.value.destroy(),d.value=null)},ge=o=>{o.forEach(n=>{ve(n.fileType)&&!E.value[n.id]&&De(n.id)})},De=async o=>{if(!E.value[o]){i.value=!0;try{const n=await Je(o),j=URL.createObjectURL(n);E.value[o]=j}catch(n){console.error(`Failed to load image preview for file ${o}:`,n)}finally{i.value=!1}}},we=async()=>{if(q.value)return Promise.resolve(await Oe(()=>import("./pdf-BOQpkqLt.js"),[]));try{N.value=!0;const o=await Oe(()=>import("./pdf-BOQpkqLt.js"),[]);return o.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs",q.value=!0,o}catch(o){throw console.error("Failed to load PDF.js:",o),h.error("PDF预览组件加载失败"),o}finally{N.value=!1}},u=async o=>{if(o){D.value=1,R.value=0,x.value=1,d.value&&(d.value.destroy(),d.value=null),N.value=!0;try{const n=await we();if(!n)throw new Error("PDF.js加载失败");const U=await(await Je(o)).arrayBuffer(),ae=await n.getDocument({data:U}).promise;d.value=ae,R.value=ae.numPages,s()}catch(n){console.error(`Failed to load PDF preview for file ${o}:`,n),h.error("PDF预览加载失败: "+(n instanceof Error?n.message:String(n)))}finally{N.value=!1}}},s=async()=>{k.value&&(k.value.cancel(),k.value=null);const o=d.value,n=m.value;if(!(!o||!n))try{N.value=!0;const j=await o.getPage(D.value),U=rl(j),ae=U.getViewport({scale:x.value}),ce=n.getContext("2d");if(!ce)throw new Error("无法获取canvas上下文");n.height=ae.height,n.width=ae.width;const ze={canvasContext:ce,viewport:ae},Be=U.render(ze);k.value=Be,await Be.promise,k.value=null}catch(j){j&&j.name!=="RenderingCancelledException"&&console.error("渲染PDF页面失败:",j),k.value=null}finally{N.value=!1}},r=()=>{D.value<R.value&&D.value++},t=()=>{D.value>1&&D.value--},w=()=>{x.value<2&&(x.value+=.25)},_=()=>{x.value>.5&&(x.value-=.25)},f=o=>{const n=O.value.findIndex(j=>j.id===o);n!==-1&&(z.value=O.value.map(j=>E.value[j.id]).filter(j=>!!j),B.value=n,L.value=!0)},c=()=>{if(!y.value)return;const o=y.value;T.value=o.scrollWidth>o.clientWidth,Q.value=o.scrollLeft<=5,J.value=o.scrollWidth-o.scrollLeft-o.clientWidth<=5},v=o=>{if(!y.value)return;const n=y.value;o==="left"&&!Q.value?n.scrollBy({left:-200,behavior:"smooth"}):o==="right"&&!J.value&&n.scrollBy({left:200,behavior:"smooth"}),setTimeout(()=>c(),300)};return Se([D,x],()=>{k.value&&(k.value.cancel(),k.value=null),d.value&&s()}),Se(g,o=>{k.value&&(k.value.cancel(),k.value=null),o&&ue(o.fileType)&&be(()=>{d.value?s():u(o.id)})}),Se(O,()=>{be(()=>c())},{deep:!0}),Xe(()=>{if(be(()=>{y.value&&(c(),y.value.addEventListener("scroll",c),window.addEventListener("resize",c))}),!document.getElementById("pdf-worker-loader")){const o=document.createElement("script");o.id="pdf-worker-loader",o.setAttribute("data-pdfjs-src","/pdf.worker.min.js"),o.setAttribute("type","text/javascript"),o.setAttribute("async","true"),o.setAttribute("defer","true"),document.head.appendChild(o)}}),ol(()=>{y.value&&y.value.removeEventListener("scroll",c),window.removeEventListener("resize",c),Object.values(E.value).forEach(o=>{o&&URL.revokeObjectURL(o)}),k.value&&(k.value.cancel(),k.value=null),d.value&&(d.value.destroy(),d.value=null)}),S({open:Z}),(o,n)=>{const j=Re("loading");return I(),K(e(Ne),{modelValue:$.value,"onUpdate:modelValue":n[7]||(n[7]=U=>$.value=U),title:"查看附件",width:"55%","before-close":se,draggable:"","destroy-on-close":"",class:"file-view-dialog"},{footer:a(()=>[C("span",pa,[l(e(M),{onClick:n[6]||(n[6]=()=>se())},{default:a(()=>n[15]||(n[15]=[b("关闭")])),_:1})])]),default:a(()=>[Ee((I(),A("div",null,[V.value.length>0?(I(),A("div",jl,[(I(!0),A(ke,null,Pe(V.value,(U,ae)=>{var ce;return I(),A("div",{key:U.id,class:Ve(["file-item",{selected:((ce=g.value)==null?void 0:ce.id)===U.id}]),onClick:ze=>ie(U)},[l(e(ee),{size:32},{default:a(()=>[l(e(Ge))]),_:1}),C("span",Ol,"文件 "+G(ae+1),1)],10,Gl)}),128))])):(I(),K(e(nl),{key:1,description:"该文档没有关联附件"})),V.value.length>0?(I(),K(e(Ye),{key:2})):re("",!0),g.value?(I(),A("div",ql,[C("h4",null,G(g.value.fileName),1),l(e(sl),{column:2,border:"",size:"small",style:{"margin-top":"10px"}},{default:a(()=>[l(e(Ie),{label:"类型"},{default:a(()=>[b(G(de(g.value.fileType)),1)]),_:1}),l(e(Ie),{label:"大小"},{default:a(()=>[b(G((g.value.fileSize/1024).toFixed(2))+" KB ",1)]),_:1}),l(e(Ie),{label:"状态"},{default:a(()=>[l(e(He),{type:fe(g.value.processingStatus),size:"small"},{default:a(()=>[b(G(me(g.value.processingStatus)),1)]),_:1},8,["type"])]),_:1}),l(e(Ie),{label:"操作"},{default:a(()=>[l(e(M),{type:"primary",link:"",size:"small",onClick:n[0]||(n[0]=U=>X(g.value)),loading:Y.value[g.value.id]},{default:a(()=>n[8]||(n[8]=[b(" 下载文件 ")])),_:1},8,["loading"])]),_:1})]),_:1}),C("div",Jl,[i.value?(I(),A("div",Yl," 加载预览中... ")):le.value&&V.value.length>0?(I(),A("div",Ql,[T.value?(I(),A("div",{key:0,class:Ve(["gallery-arrow gallery-arrow-left",{disabled:Q.value}]),onClick:n[1]||(n[1]=U=>v("left"))},[l(e(ee),{size:24},{default:a(()=>[l(e(Ae))]),_:1})],2)):re("",!0),C("div",{ref_key:"galleryRef",ref:y,class:"images-gallery"},[(I(!0),A(ke,null,Pe(O.value,U=>{var ae;return I(),A("div",{key:U.id,class:Ve(["image-thumbnail-card",{selected:((ae=g.value)==null?void 0:ae.id)===U.id}]),onClick:ce=>ie(U)},[C("div",Kl,[E.value[U.id]?(I(),A("img",{key:0,src:E.value[U.id],alt:"图片预览",class:"thumbnail-image"},null,8,Zl)):(I(),A("div",Xl,"加载中...")),C("div",{class:"thumbnail-overlay",onClick:pl(ce=>f(U.id),["stop"])},[C("span",null,[l(e(ee),null,{default:a(()=>[l(e(je))]),_:1}),n[9]||(n[9]=b(" 点击查看大图"))])],8,ea)]),C("div",la,[C("span",aa,G(de(U.fileType)),1),C("span",ta,G((U.fileSize/1024).toFixed(0))+" KB",1)])],10,Hl)}),128))],512),T.value?(I(),A("div",{key:1,class:Ve(["gallery-arrow gallery-arrow-right",{disabled:J.value}]),onClick:n[2]||(n[2]=U=>v("right"))},[l(e(ee),{size:24},{default:a(()=>[l(e(Me))]),_:1})],2)):re("",!0)])):g.value&&ue(g.value.fileType)?(I(),A("div",oa,[C("div",ra,[l(e(We),null,{default:a(()=>[l(e(M),{type:"primary",plain:"",size:"small",onClick:t,disabled:D.value<=1},{default:a(()=>[l(e(ee),null,{default:a(()=>[l(e(Ae))]),_:1}),n[10]||(n[10]=b(" 上一页 "))]),_:1},8,["disabled"]),l(e(M),{type:"primary",plain:"",size:"small"},{default:a(()=>[b(G(D.value)+" / "+G(R.value),1)]),_:1}),l(e(M),{type:"primary",plain:"",size:"small",onClick:r,disabled:D.value>=R.value},{default:a(()=>[n[11]||(n[11]=b(" 下一页 ")),l(e(ee),null,{default:a(()=>[l(e(Me))]),_:1})]),_:1},8,["disabled"])]),_:1}),l(e(We),null,{default:a(()=>[l(e(M),{type:"primary",plain:"",size:"small",onClick:_,disabled:x.value<=.5},{default:a(()=>[l(e(ee),null,{default:a(()=>[l(e(il))]),_:1})]),_:1},8,["disabled"]),l(e(M),{type:"primary",plain:"",size:"small",onClick:w,disabled:x.value>=2},{default:a(()=>[l(e(ee),null,{default:a(()=>[l(e(je))]),_:1})]),_:1},8,["disabled"])]),_:1}),l(e(M),{type:"primary",link:"",size:"small",onClick:n[3]||(n[3]=U=>X(g.value))},{default:a(()=>[l(e(ee),null,{default:a(()=>[l(e(Ue))]),_:1}),n[12]||(n[12]=b(" 下载PDF "))]),_:1})]),C("div",na,[C("canvas",{ref_key:"pdfCanvas",ref:m,class:"pdf-canvas"},null,512)]),N.value?(I(),A("div",sa,[l(e(ee),{class:"is-loading"},{default:a(()=>[l(e(dl))]),_:1}),n[13]||(n[13]=C("span",null,"加载PDF中...",-1))])):re("",!0)])):g.value?(I(),A("div",ia,[C("div",da,[l(e(ee),{size:32},{default:a(()=>[l(e(Ge))]),_:1})]),C("div",ua,[C("div",ca,G(de(g.value.fileType)),1),l(e(ul),{type:"primary",onClick:n[4]||(n[4]=U=>X(g.value)),underline:!1,class:"action-link"},{default:a(()=>[n[14]||(n[14]=b(" 下载后查看 ")),l(e(ee),{class:"el-icon--right"},{default:a(()=>[l(e(Ue))]),_:1})]),_:1})])])):re("",!0)])])):re("",!0)])),[[j,P.value]]),L.value?(I(),K(e(cl),{key:0,"url-list":z.value,"initial-index":B.value,"hide-on-click-modal":!0,onClose:n[5]||(n[5]=U=>L.value=!1)},null,8,["url-list","initial-index"])):re("",!0)]),_:1},8,["modelValue"])}}}),fa=Te(ma,[["__scopeId","data-v-6a67985b"]]),va={class:"dialog-footer"},ga=xe({__name:"ExportOptionsDialog",emits:["export-started"],setup(F,{expose:S,emit:$}){const P=p([{label:"文档 ID",value:"id"},{label:"文档名 称",value:"docName"},{label:"文档类型",value:"docTypeName"},{label:"来源部门",value:"sourceDepartmentName"},{label:"提交人",value:"submitter"},{label:"接收人",value:"receiver"},{label:"签收（章）人",value:"signer"},{label:"交接日期",value:"handoverDate"},{label:"保管位置",value:"storageLocation"},{label:"备注",value:"remarks"},{label:"创建人",value:"createdByName"},{label:"创建时间",value:"createdAt"},{label:"最后修改人",value:"updatedByName"},{label:"最后修改时间",value:"updatedAt"}]),W=p(!1),V=p(!1),g=p([]),Y=p("xlsx"),i=p("all"),E=p(null),L=p([]),B=p([]),z=$,O=te(()=>L.value.length>0),le=te(()=>L.value.length),m=te(()=>B.value.length>0),N=te(()=>B.value.length),d=(q,y=[],T=[])=>{console.log("[Debug] ExportOptionsDialog: Received selectedItemIds:",y),console.log("[Debug] ExportOptionsDialog: Received currentPageIds:",T),E.value=q,L.value=y,B.value=T,g.value=P.value.map(Q=>Q.value),y.length>0?i.value="selected":T.length>0?i.value="currentPage":i.value="all",W.value=!0},D=()=>{V.value||(W.value=!1)},R=async()=>{var q,y;if(!g.value.length){h.warning("请至少选择一个要导出的 字段");return}if(i.value==="selected"&&!O.value){h.warning("请先在表格中勾选要导出的文档");return}if(i.value==="currentPage"&&!m.value){h.warning("当前页没有可导出的数据");return}V.value=!0;try{const T={fields:g.value,fileType:Y.value,exportScope:i.value};if(i.value==="all"&&E.value){const J=E.value,Z={},se=["docName","submitter","receiver","docTypeId","sourceDepartmentId","docTypeNameFilter","sourceDepartmentNameFilter","signer"];for(const X of se)J[X]!==null&&J[X]!==void 0&&J[X]!==""&&(Z[X]=J[X]);J.handoverDateRange&&Array.isArray(J.handoverDateRange)&&J.handoverDateRange.length===2&&(Z.handoverDateStart=J.handoverDateRange[0],Z.handoverDateEnd=J.handoverDateRange[1]),Z.docTypeNameFilter===""&&delete Z.docTypeNameFilter,Z.sourceDepartmentNameFilter===""&&delete Z.sourceDepartmentNameFilter,Object.keys(Z).length>0&&(T.query=Z)}else i.value==="selected"?T.selectedIds=L.value:i.value==="currentPage"&&(T.currentPageIds=B.value);console.log("[Debug] Export Request Params:",JSON.stringify(T));const Q=await Tl(T);Q&&typeof Q.taskId=="number"?(console.log("[Debug] handleSubmit: Success path executing."),h.success('导出任务已创建，请稍后在"导出任务"页面查看进度和下载。'),z("export-started",Q.taskId),D()):(console.error("Invalid payload structure received after creating export task:",Q),console.log("[Debug] handleSubmit: Invalid payload structure path executing."),h.error("创建导出任务失败：响应数据异常"))}catch(T){console.error("Request export error:",T);const Q=((y=(q=T==null?void 0:T.response)==null?void 0:q.data)==null?void 0:y.message)||(T==null?void 0:T.message)||"创建导出任务时发生错误";console.log("[Debug] handleSubmit: Catch block executing."),h.error(Q)}finally{V.value=!1}},x=()=>{g.value=P.value.map(q=>q.value)},k=()=>{g.value=[]};return S({open:d}),(q,y)=>(I(),K(e(Ne),{modelValue:W.value,"onUpdate:modelValue":y[3]||(y[3]=T=>W.value=T),title:"导出选项",width:"650px","close-on-click-modal":!1,onClose:D},{footer:a(()=>[C("span",va,[l(e(M),{onClick:D},{default:a(()=>y[9]||(y[9]=[b("取消")])),_:1}),l(e(M),{type:"primary",onClick:R,loading:V.value},{default:a(()=>y[10]||(y[10]=[b(" 确认导出 ")])),_:1},8,["loading"])])]),default:a(()=>[l(e(Le),{"label-width":"100px"},{default:a(()=>[l(e($e),{label:"导出范围"},{default:a(()=>[l(e(qe),{modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=T=>i.value=T)},{default:a(()=>[l(e(_e),{label:"all"},{default:a(()=>y[4]||(y[4]=[b("全部 (根据筛选条件)")])),_:1}),l(e(_e),{label:"currentPage",disabled:!m.value},{default:a(()=>[b(" 当前页 ("+G(N.value)+" 项) ",1)]),_:1},8,["disabled"]),l(e(_e),{label:"selected",disabled:!O.value},{default:a(()=>[b(" 选中项 ("+G(le.value)+" 项) ",1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),l(e($e),{label:"选择字段"},{default:a(()=>[l(e(he),{gutter:10,style:{width:"100%","margin-bottom":"10px"}},{default:a(()=>[l(e(oe),{span:12},{default:a(()=>[l(e(M),{type:"primary",link:"",onClick:x},{default:a(()=>y[5]||(y[5]=[b("全选")])),_:1}),l(e(M),{type:"primary",link:"",onClick:k,style:{"margin-left":"15px"}},{default:a(()=>y[6]||(y[6]=[b("取消全选")])),_:1})]),_:1})]),_:1}),l(e(ml),{modelValue:g.value,"onUpdate:modelValue":y[1]||(y[1]=T=>g.value=T)},{default:a(()=>[l(e(he),{gutter:5,style:{width:"100%"}},{default:a(()=>[(I(!0),A(ke,null,Pe(P.value,T=>(I(),K(e(oe),{span:8,key:T.value},{default:a(()=>[l(e(fl),{label:T.value,style:{"margin-bottom":"8px"}},{default:a(()=>[b(G(T.label),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(e($e),{label:"文件类型"},{default:a(()=>[l(e(qe),{modelValue:Y.value,"onUpdate:modelValue":y[2]||(y[2]=T=>Y.value=T)},{default:a(()=>[l(e(_e),{label:"xlsx"},{default:a(()=>y[7]||(y[7]=[b("Excel (.xlsx)")])),_:1}),l(e(_e),{label:"csv"},{default:a(()=>y[8]||(y[8]=[b("CSV (.csv)")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ya=Te(ga,[["__scopeId","data-v-8a0226dc"]]),ba={class:"import-dialog-content"},ha={class:"dialog-footer"},Da=xe({__name:"ImportDialog",setup(F,{expose:S}){const $=p(!1),P=p(null),W=p(null),V=p(!1),Y="http://10.1.2.239:3000/api/v1/upload/excel",i=te(()=>{const d=localStorage.getItem("authToken");return console.log("[ImportDialog] Token from localStorage:",d?"found":"not found"),d?{Authorization:`Bearer ${d}`}:{}}),E=async()=>{console.log("[ImportDialog] open method called."),console.log("[ImportDialog] Current dialogVisible state before change:",$.value);try{B(),$.value=!0,console.log("[ImportDialog] dialogVisible set to true. Waiting for nextTick..."),await be(),console.log("[ImportDialog] After nextTick. Dialog should now be visible in the DOM."),console.log("[ImportDialog] Final dialogVisible state:",$.value)}catch(d){console.error("[ImportDialog] Error occurred within the open method:",d)}},L=()=>{if(V.value){h.warning("文件正在上传中，请稍候...");return}B(),$.value=!1},B=()=>{var d;W.value=null,(d=P.value)==null||d.clearFiles(),V.value=!1},z=(d,D)=>{var R;console.log("[ImportDialog File Change] File status:",d.name,d.status),D.length>0?(W.value=D[D.length-1],d.status==="fail"&&(W.value=null,(R=P.value)==null||R.clearFiles())):W.value=null},O=d=>{console.log("[ImportDialog Before Upload] File:",d.name);const D=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],R=50,x=R*1024*1024,k=D.includes(d.type)||d.name.endsWith(".xls")||d.name.endsWith(".xlsx"),q=d.size<=x;return k?q?!0:(h.error(`文件大小不能超过 ${R}MB!`),!1):(h.error("文件类型错误，请上传 Excel 文件 (.xls, .xlsx)"),!1)},le=()=>{var d;if(!W.value){h.warning("请先选择一个 Excel 文件");return}V.value||(console.log("[ImportDialog Manual Upload] Triggering submit..."),V.value=!0,(d=P.value)==null||d.submit())},m=(d,D,R)=>{if(console.log("[ImportDialog Upload Success] Response:",d),V.value=!1,d&&d.code===201&&d.data){h.success(d.message||"文件上传成功，导入任务已创建"),L();return}if(d&&typeof d.fileName=="string"&&typeof d.originalName=="string"){h.info("文件上传成功，正在请求后台处理导入任务...");const x={fileName:d.fileName,originalName:d.originalName};Il(x).then(k=>{(k==null?void 0:k.code)===200?(h.success("后台导入任务已创建！"),L()):h.error((k==null?void 0:k.message)||"触发导入任务失败")}).catch(k=>{var y,T;console.error("[ImportDialog Request Import] API Call Failed:",k);const q=((T=(y=k.response)==null?void 0:y.data)==null?void 0:T.message)||k.message||"请求触发导入任务时出错";h.error(`触发导入任务失败: ${q}`)})}else console.error("[ImportDialog Upload Success] Invalid upload response:",d),h.error((d==null?void 0:d.message)||"文件上传接口响应异常")},N=(d,D,R)=>{console.error("[ImportDialog Upload Error] Raw Error:",d),V.value=!1;let x="文件上传失败";try{if(d.response&&d.response.data)x=d.response.data.message||`上传失败，状态码：${d.response.status}`;else if(d.message)try{const k=JSON.parse(d.message);x=k.message?`文件上传失败: ${k.message}`:`文件上传失败: ${d.message}`}catch{x=`文件上传失败: ${d.message}`}}catch(k){console.error("[ImportDialog Upload Error] Parse error failed:",k)}h.error(x)};return S({open:E}),(d,D)=>(I(),K(e(Ne),{modelValue:$.value,"onUpdate:modelValue":D[0]||(D[0]=R=>$.value=R),title:"批量导入文档",width:"600px",modal:!0,"append-to-body":!0,onClose:L,"close-on-click-modal":!V.value,"close-on-press-escape":!V.value,onClosed:B},{footer:a(()=>[C("span",ha,[l(e(M),{onClick:L,disabled:V.value},{default:a(()=>D[3]||(D[3]=[b("取消")])),_:1},8,["disabled"]),l(e(M),{type:"primary",onClick:le,loading:V.value},{default:a(()=>[b(G(V.value?"上传中...":"确定上传并导入"),1)]),_:1},8,["loading"])])]),default:a(()=>[C("div",ba,[l(e(Ke),{ref_key:"uploadRef",ref:P,class:"upload-importer",drag:"",action:Y,headers:i.value,limit:1,"auto-upload":!1,"on-change":z,"before-upload":O,"on-success":m,"on-error":N,accept:".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{tip:a(()=>D[1]||(D[1]=[C("div",{class:"el-upload__tip"},[b(" 请上传 .xls 或 .xlsx 格式的 Excel 文件，大小不超过 50MB。"),C("br"),b(" 文件需要包含以下列：文档名称, 提交人, 接收人, [可选列: 文档类型, 来源部门, 签收人, 交接日期, 存放位置, 备注] ")],-1)])),default:a(()=>[l(e(ee),{class:"el-icon--upload"},{default:a(()=>[l(e(el))]),_:1}),D[2]||(D[2]=C("div",{class:"el-upload__text"},[b(" 将 Excel 文件拖到此处，或"),C("em",null,"点击选择")],-1))]),_:1},8,["headers"])])]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape"]))}}),wa=Te(Da,[["__scopeId","data-v-1cbb28d7"]]),_a={class:"document-list-view"},ka={class:"filter-group"},xa={class:"filter-group"},Ta={class:"toolbar"},Ia={class:"toolbar-buttons"},Va=xe({__name:"DocumentListView",setup(F){const S=p(),$=p(null),P=p(null),W=p(null),V=p(null),g=p(),Y=p([]),i=Ce({docName:"",submitter:"",receiver:"",docTypeId:null,sourceDepartmentId:null,docTypeNameFilter:"",sourceDepartmentNameFilter:"",signer:"",handoverDateRange:null,page:1,pageSize:10}),E=p([]),L=p(!1),B=p(!1),z=Ce({page:1,pageSize:10,total:0}),O=p([]),le=p([]),m={value:"id",label:"name",children:"children"},N=async u=>{var s,r,t,w;L.value=!0;try{const _={page:z.page,pageSize:z.pageSize,docName:i.docName||void 0,submitter:i.submitter||void 0,receiver:i.receiver||void 0,docTypeId:i.docTypeId??void 0,docTypeNameFilter:i.docTypeId?void 0:i.docTypeNameFilter||void 0,sourceDepartmentId:i.sourceDepartmentId??void 0,sourceDepartmentNameFilter:i.sourceDepartmentId?void 0:i.sourceDepartmentNameFilter||void 0,signer:i.signer||void 0,handoverDateStart:((s=i.handoverDateRange)==null?void 0:s[0])||void 0,handoverDateEnd:((r=i.handoverDateRange)==null?void 0:r[1])||void 0,sortField:u==null?void 0:u.prop,sortOrder:(u==null?void 0:u.order)==="descending"?"DESC":(u==null?void 0:u.order)==="ascending"?"ASC":void 0};Object.keys(_).forEach(c=>{const v=c;(_[v]===void 0||_[v]===null||_[v]==="")&&delete _[v]});const f=await Cl(_);console.log("[DocumentListView] Raw response from getDocuments service:",f),f&&Array.isArray(f.list)&&typeof f.total=="number"?(console.log("[DocumentListView] Trying to extract from result directly"),E.value=f.list,z.total=f.total):(console.error("Invalid data structure received from getDocuments:",f),h.error("获取文档列表失败：数据格式错误"),E.value=[],z.total=0)}catch(_){console.error("Fetch documents error:",_);const f=((w=(t=_==null?void 0:_.response)==null?void 0:t.data)==null?void 0:w.message)||(_==null?void 0:_.message)||"获取文档列表时发生错误";h.error(f),E.value=[],z.total=0}finally{L.value=!1}},d=async()=>{B.value=!0;try{O.value=await xl()}catch(u){console.error("Error fetching document type tree:",u),h.error("获取文档类型失败")}finally{B.value=!1}},D=async()=>{B.value=!0;try{le.value=await vl()}catch(u){console.error("Error fetching department tree:",u),h.error("获取部门失败")}finally{B.value=!1}},R=()=>{z.page=1,N()},x=()=>{var u;(u=S.value)==null||u.resetFields(),i.docTypeId=null,i.sourceDepartmentId=null,i.docTypeNameFilter="",i.sourceDepartmentNameFilter="",i.handoverDateRange=null,i.docName="",i.submitter="",i.receiver="",i.signer="",R()},k=u=>{const{prop:s,order:r}=u;s&&r?N({prop:s,order:r}):N()},q=u=>{N()},y=u=>{N()},T=()=>{var u;(u=$.value)==null||u.open("add")},Q=u=>{var s;(s=$.value)==null||s.open("view",u)},J=u=>{var s;(s=$.value)==null||s.open("edit",u)},Z=async u=>{if(typeof u.id!="number"){h.error("无法删除：文档 ID 无效");return}try{await Ze.confirm(`确定要删除文档 "${u.docName||"未知名称"}" 吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),L.value=!0,await Nl(u.id),h.success(`删除文档 "${u.docName||"未知名称"}" 成功`),N()}catch(s){s!=="cancel"&&(console.error("删除文档失败:",s),h.error(`删除文档失败: ${(s==null?void 0:s.message)||"未知错误"}`))}finally{L.value=!1}},se=u=>{Y.value=u.map(s=>s.id).filter(s=>typeof s=="number"),console.log("[Debug] DocumentListView: Selection changed, selected IDs:",Y.value)},X=()=>{if(W.value){const u=E.value.map(s=>s.id).filter(s=>typeof s=="number");W.value.open(i,Y.value,u)}},de=async()=>{if(console.log("[DocumentListView] handleImportClick called"),!V.value){console.error("[DocumentListView] Import dialog reference is null"),h.error("导入对话框组件未正确加载，请刷新页面重试");return}try{console.log("[DocumentListView] Opening import dialog..."),await V.value.open(),console.log("[DocumentListView] Import dialog opened successfully.")}catch(u){console.error("[DocumentListView] Error opening import dialog:",u),h.error("打开导入对话框时发生错误，请刷新页面重试")}},me=(u,s=!1)=>{if(!u)return"-";try{const r=new Date(u);if(isNaN(r.getTime()))return"-";const t=r.getFullYear(),w=(r.getMonth()+1).toString().padStart(2,"0"),_=r.getDate().toString().padStart(2,"0");if(s)return`${t}-${w}-${_}`;const f=r.getHours().toString().padStart(2,"0"),c=r.getMinutes().toString().padStart(2,"0"),v=r.getSeconds().toString().padStart(2,"0");return`${t}-${w}-${_} ${f}:${c}:${v}`}catch(r){return console.error("Error formatting date:",u,r),"-"}},fe=u=>me(u,!0),ve=u=>me(u);Xe(()=>{console.log("[DocumentListView] onMounted STARTING..."),d(),D(),N()});const ue=u=>{u!==null&&(i.docTypeNameFilter="")},ie=u=>{u&&(i.docTypeId=null)},ge=u=>{u!==null&&(i.sourceDepartmentNameFilter="")},De=u=>{u&&(i.sourceDepartmentId=null)},we=u=>{var s;u.id?(s=P.value)==null||s.open(u.id):h.error("无法预览附件：无效的文档ID。")};return(u,s)=>{const r=pe("el-form-item"),t=pe("el-date-picker"),w=pe("el-button"),_=pe("el-card"),f=pe("el-table-column"),c=Re("loading");return I(),A("div",_a,[l(_,{class:"search-card",shadow:"never"},{default:a(()=>[l(e(Le),{model:i,ref_key:"searchFormRef",ref:S,"label-width":"70px",class:"search-form"},{default:a(()=>[l(r,{label:"文档名称",prop:"docName"},{default:a(()=>[l(e(H),{modelValue:i.docName,"onUpdate:modelValue":s[0]||(s[0]=v=>i.docName=v),placeholder:"输入文档名称",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"提交人",prop:"submitter"},{default:a(()=>[l(e(H),{modelValue:i.submitter,"onUpdate:modelValue":s[1]||(s[1]=v=>i.submitter=v),placeholder:"输入提交人",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"接收人",prop:"receiver"},{default:a(()=>[l(e(H),{modelValue:i.receiver,"onUpdate:modelValue":s[2]||(s[2]=v=>i.receiver=v),placeholder:"输入接收人",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"文档类型",prop:"docTypeId"},{default:a(()=>[C("div",ka,[l(e(Fe),{modelValue:i.docTypeId,"onUpdate:modelValue":s[3]||(s[3]=v=>i.docTypeId=v),placeholder:"选择精确类型",data:O.value,props:m,"check-strictly":"","render-after-expand":!1,clearable:"",loading:B.value,style:{width:"180px"},onChange:ue},null,8,["modelValue","data","loading"]),l(e(H),{modelValue:i.docTypeNameFilter,"onUpdate:modelValue":s[4]||(s[4]=v=>i.docTypeNameFilter=v),placeholder:"或输入模糊类型",clearable:"",style:{width:"150px"},onInput:ie,onClear:s[5]||(s[5]=()=>{i.docTypeNameFilter=""})},null,8,["modelValue"])])]),_:1}),l(r,{label:"来源部门",prop:"sourceDepartmentId"},{default:a(()=>[C("div",xa,[l(e(Fe),{modelValue:i.sourceDepartmentId,"onUpdate:modelValue":s[6]||(s[6]=v=>i.sourceDepartmentId=v),placeholder:"选择精确部门",data:le.value,props:m,"check-strictly":"","render-after-expand":!1,clearable:"",loading:B.value,style:{width:"180px"},onChange:ge},null,8,["modelValue","data","loading"]),l(e(H),{modelValue:i.sourceDepartmentNameFilter,"onUpdate:modelValue":s[7]||(s[7]=v=>i.sourceDepartmentNameFilter=v),placeholder:"或输入模糊部门",clearable:"",style:{width:"150px"},onInput:De,onClear:s[8]||(s[8]=()=>{i.sourceDepartmentNameFilter=""})},null,8,["modelValue"])])]),_:1}),l(r,{label:"签章人",prop:"signer"},{default:a(()=>[l(e(H),{modelValue:i.signer,"onUpdate:modelValue":s[9]||(s[9]=v=>i.signer=v),placeholder:"签章人",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"交接日期",prop:"handoverDateRange"},{default:a(()=>[l(t,{modelValue:i.handoverDateRange,"onUpdate:modelValue":s[10]||(s[10]=v=>i.handoverDateRange=v),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"",class:"search-buttons"},{default:a(()=>[l(w,{type:"primary",onClick:R,icon:e(gl)},{default:a(()=>s[13]||(s[13]=[b("搜索")])),_:1},8,["icon"]),l(w,{onClick:x,icon:e(yl)},{default:a(()=>s[14]||(s[14]=[b("重置")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l(_,{class:"table-card",shadow:"never"},{default:a(()=>[C("div",Ta,[C("div",Ia,[l(w,{type:"primary",onClick:T,icon:e(bl)},{default:a(()=>s[15]||(s[15]=[b("新增文档")])),_:1},8,["icon"]),l(w,{type:"success",onClick:de,icon:e(el)},{default:a(()=>s[16]||(s[16]=[b("批量导入")])),_:1},8,["icon"]),l(w,{type:"warning",onClick:X,icon:e(Ue),style:{"margin-left":"10px"}},{default:a(()=>s[17]||(s[17]=[b("批量导出")])),_:1},8,["icon"])])]),Ee((I(),K(e(Qe),{ref_key:"tableRef",ref:g,data:E.value,style:{width:"100%"},stripe:"",border:"",onSortChange:k,"default-sort":{prop:"createdAt",order:"descending"},onSelectionChange:se,"row-key":"id"},{default:a(()=>[l(f,{type:"selection",width:"45","reserve-selection":!0}),l(f,{prop:"id",label:"ID",width:"70",sortable:""}),l(f,{prop:"docName",label:"文档名称",width:"355","show-overflow-tooltip":""}),l(f,{prop:"docTypeName",label:"文档类型",width:"120","show-overflow-tooltip":""}),l(f,{prop:"departmentName",label:"来源部门",width:"120","show-overflow-tooltip":""}),l(f,{prop:"submitter",label:"提交人",width:"90"}),l(f,{prop:"receiver",label:"接收人",width:"90"}),l(f,{prop:"signer",label:"签章人",width:"90"}),l(f,{prop:"handoverDate",label:"交接日期",width:"110",align:"center",sortable:"custom"},{default:a(({row:v})=>[b(G(fe(v.handoverDate)),1)]),_:1}),l(f,{prop:"createdBy",label:"创建人",width:"90"}),l(f,{prop:"createdAt",label:"创建时间",width:"200",align:"center",sortable:"custom"},{default:a(({row:v})=>[b(G(ve(v.createdAt)),1)]),_:1}),l(f,{label:"操作",width:"260",align:"center",fixed:"right"},{default:a(({row:v})=>[l(w,{type:"primary",link:"",size:"small",icon:e(hl),onClick:o=>Q(v)},{default:a(()=>s[18]||(s[18]=[b("查看")])),_:2},1032,["icon","onClick"]),l(w,{type:"primary",link:"",size:"small",icon:e(Dl),onClick:o=>J(v)},{default:a(()=>s[19]||(s[19]=[b("编辑")])),_:2},1032,["icon","onClick"]),l(w,{type:"success",link:"",size:"small",icon:e(wl),onClick:o=>we(v),disabled:!v.fileCount||v.fileCount===0},{default:a(()=>s[20]||(s[20]=[b("预览文件")])),_:2},1032,["icon","onClick","disabled"]),l(w,{type:"danger",link:"",size:"small",icon:e(_l),onClick:o=>Z(v)},{default:a(()=>s[21]||(s[21]=[b("删除")])),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[c,L.value]]),l(e(kl),{class:"pagination-container","current-page":z.page,"onUpdate:currentPage":s[11]||(s[11]=v=>z.page=v),"page-size":z.pageSize,"onUpdate:pageSize":s[12]||(s[12]=v=>z.pageSize=v),"page-sizes":[10,20,50,100],total:z.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1}),l(Wl,{ref_key:"documentFormDialogRef",ref:$,"doc-type-tree-data":O.value,"department-tree-data":le.value,onSuccess:N},null,8,["doc-type-tree-data","department-tree-data"]),l(fa,{ref_key:"documentFileViewDialogRef",ref:P},null,512),l(ya,{ref_key:"exportOptionsDialogRef",ref:W},null,512),l(wa,{ref_key:"importDialogRef",ref:V},null,512)])}}}),Na=Te(Va,[["__scopeId","data-v-fa3f063e"]]);export{Na as default};